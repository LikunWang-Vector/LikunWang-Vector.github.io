---
title: "36. å®æˆ˜ï¼šåŸºäºä¸Šä¸€èŠ‚çš„å…¨é¢å‡çº§â€”â€”å®ç°æŸéŸ³æ‰¹é‡ä¸‹è½½åŠŸèƒ½"
date: 2023-02-01
updated: 2023-02-01
categories:
  - Pythonçˆ¬è™«å…¥é—¨ã€è¿›é˜¶ä¸å®æˆ˜
tags:
  - python
  - selenium
  - æµ‹è¯•å·¥å…·
  - çº¿ç¨‹æ± 
  - æ•°æ®åˆ†æ
csdn_views: 790
csdn_likes: 4
csdn_comments: 6
csdn_favorites: 6
csdn_url: https://blog.csdn.net/m0_59180666/article/details/128828084
cover: /images/posts/36.-å®æˆ˜ï¼šåŸºäºä¸Šä¸€èŠ‚çš„å…¨é¢å‡çº§â€”â€”å®ç°æŸéŸ³æ‰¹é‡ä¸‹è½½åŠŸèƒ½/fd082fdf5276.png
lang_pair:
  en: "36. Practical: Batch Video Download with Thread Pool"
---

> æœ¬æ–‡è¿ç§»è‡ªCSDNåšå®¢
> åŸæ–‡é“¾æ¥ï¼š[36. å®æˆ˜ï¼šåŸºäºä¸Šä¸€èŠ‚çš„å…¨é¢å‡çº§â€”â€”å®ç°æŸéŸ³æ‰¹é‡ä¸‹è½½åŠŸèƒ½](https://blog.csdn.net/m0_59180666/article/details/128828084)
> ğŸ“Š 790 é˜…è¯» | ğŸ‘ 4 ç‚¹èµ | ğŸ’¬ 6 è¯„è®º | â­ 6 æ”¶è—

**ç›®å½•**

å‰è¨€

ç›®çš„

æ€è·¯

ä»£ç å®ç°

1\. å…ˆå°†ä¸‹è½½å•ä¸ªè§†é¢‘çš„åŠŸèƒ½å°è£…æˆå‡½æ•°

2\. è·å–ä¸‹è½½åˆ—è¡¨

3\. åˆ›å»ºçº¿ç¨‹æ± è°ƒç”¨ä¸‹è½½å‡½æ•°

å®Œæ•´æºç 

è¿è¡Œæ•ˆæœ

æ€»ç»“

* * *

### å‰è¨€

ä¸Šä¸€èŠ‚æˆ‘ä»¬å®ç°äº†[æŸçŸ­è§†é¢‘å¹³å°çš„å»æ°´å°ä¸‹è½½åŠŸèƒ½](https://blog.csdn.net/m0_59180666/article/details/128818460?spm=1001.2014.3001.5501 "æŸçŸ­è§†é¢‘å¹³å°çš„å»æ°´å°ä¸‹è½½åŠŸèƒ½")ï¼Œæœ¬èŠ‚æˆ‘ä»¬å®ç°æ‰¹é‡æŠ“å–ï¼šç»™å®šæŸä¸€ä¸ªç”¨æˆ·ä¸»é¡µï¼ŒæŠ“å–ä»–çš„å…¨éƒ¨è§†é¢‘ã€‚

* * *

### ç›®çš„

åŸºäºå¤šçº¿ç¨‹å®ç°é«˜æ•ˆæ‰¹é‡æŠ“å–ä»»æ„ä¸»é¡µçš„å…¨éƒ¨è§†é¢‘

* * *

### æ€è·¯

1\. æˆ‘ä»¬å®é™…ä¸Šå·²ç»å®ç°äº†å•ä¸ªè§†é¢‘çš„æ— æ°´å°ä¸‹è½½ï¼Œé‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦ä»ä¸»é¡µè·å¾—å¤§é‡çš„è§†é¢‘é“¾æ¥å³å¯

2\. è®¿é—®ç”¨æˆ·ä¸»é¡µï¼Œå®¡æŸ¥å…ƒç´ ï¼Œæ‰¾åˆ°è§†é¢‘åˆ—è¡¨ï¼Œè·å–å¤§é‡é“¾æ¥

3\. åˆ›å»º[çº¿ç¨‹æ± ](https://blog.csdn.net/m0_59180666/article/details/128581928 "çº¿ç¨‹æ± ")ï¼Œå°†è§†é¢‘é“¾æ¥æ”¾å…¥å•ä¸ªè§†é¢‘ä¸‹è½½çš„å‡½æ•°æ‰¹é‡æ‰§è¡Œ

* * *

### ä»£ç å®ç°

#### 1\. å…ˆå°†ä¸‹è½½å•ä¸ªè§†é¢‘çš„åŠŸèƒ½å°è£…æˆå‡½æ•°

```python def grab_single_video(link): url = f'{link}' headers = { 'cookie': 'douyin.com; __ac_nonce=063d749310021f8bd394b; __ac_signature=_02B4Z6wo00f01R8urHgAAIDBnyxWOmwmfMUfDqjAACQfd6; ttwid=1%7CtRZY98IpvYfhjM-VRDQHgX3mgPcfWwWxylxnwwC7fFk%7C0%7C9af2c384c7d2b4e10ec0497fce797af996c72dd3868ec040595de36132c01ad0; home_can_add_dy_2_desktop=%220%22; passport_csrf_token=ee0cbadbf97ac430daac207c46997ca1; passport_csrf_token_default=ee0cbadbf97ac430daac207c46997ca1; strategyABtestKey=%221675053365.079%22; s_v_web_id=verify_ldibiwgl_ycqaypzT_aJxd_4ZEW_9iGD_XkAPFGlhzwd3; AB_LOGIN_GUIDE_TIMESTAMP=%221675053363589%22; msToken=L3xfxnCP4kW9_qabjW3S1cud_5DmI99tIEOw1_lJDMgdp1GJ9KQd6HWXKepYY-7iLlj4SR_V02zL3lYO6FVnXoPPVNneC5bD9cEnYN4nNpXzaNmvq7oA; ttcid=a598309ef5f3442b95f1d979574083f925; tt_scid=Px0Q21O38QIdeziR7nBXUqfZYJaS4qKakt5Zkfio72r9U4XaJdOYTb37LsjIrRLQca96; msToken=xibNm7RgEpzX8c6UaAgkzAOHMr5TcWNmNbfFR1vD-3uNUhtRXEqVQrmPIV6iDsnsA3WhMCTIOGDtST_F9GEyq8In6Dj7ug-RXsQ6dWDIjzE3OXKr5dlj', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/109.0.0.0 Safari/537.36' } resp = requests.get(url=url, headers=headers) # resp = urllib.parse.unquote(resp.text) # print(resp.text) # æ­£åˆ™æŠ“æ ‡é¢˜ obj = re.compile(r"<span><span><span><span>(?P<title>.*?)</span></span></span></span>", re.S) title = obj.search(resp.text).group("title") # print(title) # æ­£åˆ™æŠ“è§†é¢‘ä¿¡æ¯ info = re.findall('<script id="RENDER_DATA" type="application/json">(.*?)</script', resp.text)[0] # print(info) # urlè§£ç  html_data = urllib.parse.unquote(info) html_data = json.loads(html_data) # pprint(html_data) # è®©å­—å…¸æ›´åŠ ç¾è§‚ # å­—å…¸å–å€¼ï¼Œæ‹¿è§†é¢‘æ’­æ”¾é“¾æ¥ video_url = 'https:' + html_data['41']['aweme']['detail']['video']['bitRateList'][0]['playAddr'][0]['src'] # print(video_url) # è·å–è§†é¢‘äºŒè¿›åˆ¶æ•°æ® video_content = resp = requests.get(url=video_url, headers=headers).content # ä¿å­˜è§†é¢‘ if not os.path.exists('./4_video_batch'): os.mkdir('./4_video_batch') with open('./4_video_batch/' + title + '.mp4', mode='wb') as f: f.write(video_content) ``` 

è¯¦ç»†è®²è§£è§ä¸Šä¸€èŠ‚ï¼š[35\. å®æˆ˜ï¼šPythonå®ç°è§†é¢‘å»æ°´å°ï¼ˆæ–‡æœ«æºç ï¼‰](https://blog.csdn.net/m0_59180666/article/details/128818460?spm=1001.2014.3001.5501 "35. å®æˆ˜ï¼šPythonå®ç°è§†é¢‘å»æ°´å°ï¼ˆæ–‡æœ«æºç ï¼‰")

#### 2\. è·å–ä¸‹è½½åˆ—è¡¨

è¿™é‡Œç”¨äº†[selenium](https://blog.csdn.net/m0_59180666/article/details/128699574 "selenium")çš„å¾ªç¯æ»šåŠ¨åŠŸèƒ½ï¼Œä¸€ç›´æ‹‰åˆ°ä¸»é¡µæœ€ä¸‹é¢æ‰åœæ­¢ï¼Œè€Œåˆ¤æ–­å®ƒåœæ­¢çš„æ–¹æ³•å°±æ˜¯æ»šåŠ¨æ¡ä¸Šä¸‹çš„è·ç¦»ç›¸ç­‰ï¼Œè¿˜æ˜¯æ¯”è¾ƒå·§å¦™çš„ã€‚

ç„¶åå®¡æŸ¥å…ƒç´ å‘ç°è§†é¢‘åˆ—è¡¨æ”¾åœ¨CSSé€‰æ‹©å™¨é‡Œé¢ï¼Œå¹¶ä¸”éƒ½åœ¨ä¸€ä¸ªclassé‡Œï¼Œé‚£ä¹ˆå°±ç”¨æˆ‘ä»¬åˆšå­¦è¿‡çš„çŸ¥è¯†ï¼Œç”¨CSSé€‰æ‹©å™¨ç­›é€‰å‡ºè¿™ä¸ªclassçš„æ‰€æœ‰åˆ—è¡¨é¡¹ã€‚

åˆ›å»ºä¸€ä¸ªç©ºåˆ—è¡¨ï¼Œéå†æ‰€æœ‰çš„åˆ—è¡¨é¡¹ï¼Œå°†å…¶ä¸­çš„hrefå†™å…¥åˆ—è¡¨å³å¯ï¼Œæœ€åè¿”å›åˆ—è¡¨ã€‚ 

```python def grab_video_list(): # å‡†å¤‡å¥½å‚æ•°é…ç½® opt = Options() opt.add_argument("--headless") opt.add_argument("--disable-gpu") driver = Chrome(options=opt) # æŠŠå‚æ•°é…ç½®è®¾ç½®åˆ°æµè§ˆå™¨ä¸­ driver.get('è§è¯„è®ºåŒº') # å‘ä¸‹æ»šåŠ¨è‡³å…ƒç´ å¯è§ï¼ˆç¿»å®Œè¿™äººçš„ä¸»é¡µï¼‰ # å®šä¹‰ä¸€ä¸ªåˆå§‹å€¼ temp_height = 0 while True: # å¾ªç¯å°†æ»šåŠ¨æ¡ä¸‹æ‹‰ driver.execute_script("window.scrollBy(0,1000)") # sleepä¸€ä¸‹è®©æ»šåŠ¨æ¡ååº”ä¸€ä¸‹ time.sleep(1) # è·å–å½“å‰æ»šåŠ¨æ¡è·ç¦»é¡¶éƒ¨çš„è·ç¦» check_height = driver.execute_script( "return document.documentElement.scrollTop || window.pageYOffset || document.body.scrollTop;") # å¦‚æœä¸¤è€…ç›¸ç­‰è¯´æ˜åˆ°åº•äº† if check_height == temp_height: break temp_height = check_height print(check_height) lis = driver.find_elements(By.CSS_SELECTOR, '.Eie04v01') url_list = [] for li in lis: url = li.find_element(By.CSS_SELECTOR, 'a').get_attribute('href') # print(url) url_list.append(url) return url_list ``` 

#### 3\. åˆ›å»ºçº¿ç¨‹æ± è°ƒç”¨ä¸‹è½½å‡½æ•°

å…¶å®å°±æ˜¯ä¸»å‡½æ•°çš„é€»è¾‘

```python def main(): video_list = grab_video_list() # åˆ›å»ºçº¿ç¨‹æ±  with ThreadPoolExecutor(50) as t: for i in video_list: t.submit(grab_single_video, link=i) # ç­‰å¾…çº¿ç¨‹æ± ä¸­çš„ä»»åŠ¡å…¨éƒ¨æ‰§è¡Œå®Œæ¯• print("Clear!!!") ``` 

å…ˆç”¨è·å–ä¸‹è½½åˆ—è¡¨å‡½æ•°æ‹¿åˆ°ä¸»é¡µæ‰€æœ‰é“¾æ¥ï¼Œç„¶ååˆ›å»ºçº¿ç¨‹æ± ï¼Œå°†æ‰€æœ‰é“¾æ¥æ‰”è¿›ä¸‹è½½å‡½æ•°ã€‚

ï¼ˆå…¶å®è¿™é‡Œå¯ä»¥æ”¹è¿›ï¼Œç”¨å¼‚æ­¥çš„æ–¹æ³•æŠŠé“¾æ¥å…¨éƒ¨è¾“å…¥è¿›å»ï¼‰ 

* * *

### å®Œæ•´æºç 

```python import requests import re import json import urllib from urllib import parse import os from pprint import pprint from selenium.webdriver import Chrome from selenium.webdriver.chrome.options import Options from selenium.webdriver.common.by import By import time from concurrent.futures import ThreadPoolExecutor """ å¸¸è§„æ‰¾è§†é¢‘èµ„æºï¼šåˆ°Network --> Mediaé‡Œé¢æŠ“åŒ…ï¼Œå°±èƒ½å¾—åˆ°åœ°å€ ç„¶ååœ¨Mediaé‡Œé¢æ‹¿åˆ°åœ°å€ï¼Œå»å…¨å±€æœç´¢URLæ¥æº """ def grab_video_list(): # å‡†å¤‡å¥½å‚æ•°é…ç½® opt = Options() opt.add_argument("--headless") opt.add_argument("--disable-gpu") driver = Chrome(options=opt) # æŠŠå‚æ•°é…ç½®è®¾ç½®åˆ°æµè§ˆå™¨ä¸­ driver.get('è§è¯„è®ºåŒº') # å‘ä¸‹æ»šåŠ¨è‡³å…ƒç´ å¯è§ï¼ˆç¿»å®Œè¿™äººçš„ä¸»é¡µï¼‰ # å®šä¹‰ä¸€ä¸ªåˆå§‹å€¼ temp_height = 0 while True: # å¾ªç¯å°†æ»šåŠ¨æ¡ä¸‹æ‹‰ driver.execute_script("window.scrollBy(0,1000)") # sleepä¸€ä¸‹è®©æ»šåŠ¨æ¡ååº”ä¸€ä¸‹ time.sleep(1) # è·å–å½“å‰æ»šåŠ¨æ¡è·ç¦»é¡¶éƒ¨çš„è·ç¦» check_height = driver.execute_script( "return document.documentElement.scrollTop || window.pageYOffset || document.body.scrollTop;") # å¦‚æœä¸¤è€…ç›¸ç­‰è¯´æ˜åˆ°åº•äº† if check_height == temp_height: break temp_height = check_height print(check_height) lis = driver.find_elements(By.CSS_SELECTOR, '.Eie04v01') url_list = [] for li in lis: url = li.find_element(By.CSS_SELECTOR, 'a').get_attribute('href') # print(url) url_list.append(url) return url_list def grab_single_video(link): url = f'{link}' headers = { 'cookie': 'douyin.com; __ac_nonce=063d749310021f8bd394b; __ac_signature=_02B4Z6wo00f01R8urHgAAIDBnyxWOmwmfMUfDqjAACQfd6; ttwid=1%7CtRZY98IpvYfhjM-VRDQHgX3mgPcfWwWxylxnwwC7fFk%7C0%7C9af2c384c7d2b4e10ec0497fce797af996c72dd3868ec040595de36132c01ad0; home_can_add_dy_2_desktop=%220%22; passport_csrf_token=ee0cbadbf97ac430daac207c46997ca1; passport_csrf_token_default=ee0cbadbf97ac430daac207c46997ca1; strategyABtestKey=%221675053365.079%22; s_v_web_id=verify_ldibiwgl_ycqaypzT_aJxd_4ZEW_9iGD_XkAPFGlhzwd3; AB_LOGIN_GUIDE_TIMESTAMP=%221675053363589%22; msToken=L3xfxnCP4kW9_qabjW3S1cud_5DmI99tIEOw1_lJDMgdp1GJ9KQd6HWXKepYY-7iLlj4SR_V02zL3lYO6FVnXoPPVNneC5bD9cEnYN4nNpXzaNmvq7oA; ttcid=a598309ef5f3442b95f1d979574083f925; tt_scid=Px0Q21O38QIdeziR7nBXUqfZYJaS4qKakt5Zkfio72r9U4XaJdOYTb37LsjIrRLQca96; msToken=xibNm7RgEpzX8c6UaAgkzAOHMr5TcWNmNbfFR1vD-3uNUhtRXEqVQrmPIV6iDsnsA3WhMCTIOGDtST_F9GEyq8In6Dj7ug-RXsQ6dWDIjzE3OXKr5dlj', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/109.0.0.0 Safari/537.36' } resp = requests.get(url=url, headers=headers) # resp = urllib.parse.unquote(resp.text) # print(resp.text) # æ­£åˆ™æŠ“æ ‡é¢˜ obj = re.compile(r"<span><span><span><span>(?P<title>.*?)</span></span></span></span>", re.S) title = obj.search(resp.text).group("title") # print(title) # æ­£åˆ™æŠ“è§†é¢‘ä¿¡æ¯ info = re.findall('<script id="RENDER_DATA" type="application/json">(.*?)</script', resp.text)[0] # print(info) # urlè§£ç  html_data = urllib.parse.unquote(info) html_data = json.loads(html_data) # pprint(html_data) # è®©å­—å…¸æ›´åŠ ç¾è§‚ # å­—å…¸å–å€¼ï¼Œæ‹¿è§†é¢‘æ’­æ”¾é“¾æ¥ video_url = 'https:' + html_data['41']['aweme']['detail']['video']['bitRateList'][0]['playAddr'][0]['src'] # print(video_url) # è·å–è§†é¢‘äºŒè¿›åˆ¶æ•°æ® video_content = resp = requests.get(url=video_url, headers=headers).content # ä¿å­˜è§†é¢‘ if not os.path.exists('./4_video_batch'): os.mkdir('./4_video_batch') with open('./4_video_batch/' + title + '.mp4', mode='wb') as f: f.write(video_content) def main(): video_list = grab_video_list() # åˆ›å»ºçº¿ç¨‹æ±  with ThreadPoolExecutor(50) as t: for i in video_list: t.submit(grab_single_video, link=i) # ç­‰å¾…çº¿ç¨‹æ± ä¸­çš„ä»»åŠ¡å…¨éƒ¨æ‰§è¡Œå®Œæ¯• print("Clear!!!") if __name__ == '__main__': main() ``` 

* * *

### è¿è¡Œæ•ˆæœ

è¿™é‡Œç”¨æˆ‘å®¶å’¯å’¯çš„ä¸»é¡µä¸ºä¾‹æ¼”ç¤ºä¸€ä¸‹ï¼ˆçº¯è·¯äººï¼‰ï¼š

![](/images/posts/36.-å®æˆ˜ï¼šåŸºäºä¸Šä¸€èŠ‚çš„å…¨é¢å‡çº§â€”â€”å®ç°æŸéŸ³æ‰¹é‡ä¸‹è½½åŠŸèƒ½/fd082fdf5276.png)

æŠŠä¸»é¡µé“¾æ¥å¤åˆ¶è¿›URLï¼Œè¿è¡Œï¼š

> ï¼ˆè¾“å‡ºçš„æ•°å­—æ˜¯æ»šåŠ¨æ¡é«˜åº¦ï¼Œä¸‹è½½è¿‡ç¨‹å› ç½‘é€Ÿè€Œå¼‚ï¼Œåªè¦ä¸æŠ¥é”™å°±åœ¨ä¸‹è½½ã€‚ï¼‰
> 
> ï¼ˆå¦‚æœæƒ³çœ‹å¾—æ¸…æ¥šå¯ä»¥åœ¨ä¸‹è½½å•ä¸ªè§†é¢‘çš„å‡½æ•°é‚£é‡Œè‡ªå·±åŠ ä¸€ä¸ªprintè¾“å‡ºï¼Œæˆ‘å°±ä¸åŠ äº†ï¼‰

![](/images/posts/36.-å®æˆ˜ï¼šåŸºäºä¸Šä¸€èŠ‚çš„å…¨é¢å‡çº§â€”â€”å®ç°æŸéŸ³æ‰¹é‡ä¸‹è½½åŠŸèƒ½/31fd6f184061.png)

![](/images/posts/36.-å®æˆ˜ï¼šåŸºäºä¸Šä¸€èŠ‚çš„å…¨é¢å‡çº§â€”â€”å®ç°æŸéŸ³æ‰¹é‡ä¸‹è½½åŠŸèƒ½/95fe9027fefa.png)

* * *

### æ€»ç»“

æœ¬èŠ‚åŸºäºå¤šçº¿ç¨‹å®ç°äº†é«˜æ•ˆæ‰¹é‡æŠ“å–ä»»æ„ä¸»é¡µçš„å…¨éƒ¨è§†é¢‘ï¼Œåªéœ€è¦æ›¿æ¢ä¸»é¡µURLå³å¯ã€‚ç¤ºä¾‹URLæˆ‘æ”¾åœ¨è¯„è®ºåŒºäº†ï¼Œæœ‰éœ€è¦çš„è‡ªå–å³å¯ï¼ä¹Ÿå¯ä»¥é€‰è‡ªå·±å–œæ¬¢çš„åšä¸»æµ‹è¯•ä¸€ä¸‹ã€‚
