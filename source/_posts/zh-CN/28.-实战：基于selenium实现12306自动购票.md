---
title: "28. å®æˆ˜ï¼šåŸºäºseleniumå®ç°12306è‡ªåŠ¨è´­ç¥¨"
date: 2023-01-19
updated: 2023-01-19
categories:
  - Pythonçˆ¬è™«å…¥é—¨ã€è¿›é˜¶ä¸å®æˆ˜
tags:
  - selenium
  - æµ‹è¯•å·¥å…·
  - python
csdn_views: 9810
csdn_likes: 40
csdn_comments: 33
csdn_favorites: 133
csdn_url: https://blog.csdn.net/m0_59180666/article/details/128735509
cover: /images/posts/28.-å®æˆ˜ï¼šåŸºäºseleniumå®ç°12306è‡ªåŠ¨è´­ç¥¨/6dbf8c615639.png
lang_pair:
  en: "28. Practical: Auto Ticket Booking on 12306 with Selenium"
---

> æœ¬æ–‡è¿ç§»è‡ªCSDNåšå®¢
> åŸæ–‡é“¾æ¥ï¼š[28. å®æˆ˜ï¼šåŸºäºseleniumå®ç°12306è‡ªåŠ¨è´­ç¥¨](https://blog.csdn.net/m0_59180666/article/details/128735509)
> ğŸ“Š 9810 é˜…è¯» | ğŸ‘ 40 ç‚¹èµ | ğŸ’¬ 33 è¯„è®º | â­ 133 æ”¶è—

**ç›®å½•**

å‰è¨€

ç›®çš„

æ€è·¯

ä»£ç å®ç°

1\. è¿›å…¥ç™»å½•ç•Œé¢ï¼Œè¾“å…¥è´¦å·å¯†ç 

2\. ç‚¹å‡»ç™»å½•æŒ‰é’®ï¼Œå®Œæˆæ»‘å—éªŒè¯

3\. åœ¨ä¸ªäººä¸­å¿ƒç‚¹å‡»è´­ç¥¨ï¼Œè·³è½¬

4\. è¾“å…¥å‡ºå‘åœ°ã€ç›®çš„åœ°ï¼Œä»æ§åˆ¶å°è¾“å…¥å¾—åˆ°

5\. æ–‡æœ¬æ¡†è¾“å…¥å‡ºå‘æ—¥

6\. è‹¥æ˜¯å­¦ç”Ÿç¥¨åˆ™åˆ‡æ¢ç¥¨å‹

7\. ç‚¹å‡»æŸ¥è¯¢

8\. å®šä½é¢„å®šæŒ‰é’®ï¼Œç‚¹å‡»è·³è½¬è´­ç¥¨é¡µé¢

9\. é€‰æ‹©å­¦ç”Ÿä¹˜å®¢ï¼Œå¹¶åœ¨å¼¹çª—ä¸­ç¡®è®¤è´­ä¹°å­¦ç”Ÿç¥¨

10\. æäº¤è®¢å•ï¼Œç­‰å¾…ä»˜æ¬¾

**å®Œæ•´ä»£ç **

**è¿è¡Œæ•ˆæœ**

æ€»ç»“

* * *

### å‰è¨€

æˆ‘ä»¬å·²ç»å­¦ä¼šäº†seleniumçš„åŸºæœ¬æ“ä½œï¼Œå¹¶ä¸”å­¦ä¼šäº†ç”¨å®ƒå¤„ç†éªŒè¯ç ã€è·³è½¬ç½‘é¡µã€å¤„ç†å†…è”æ¡†æ¶ç­‰æ“ä½œï¼Œç°åœ¨å¯ä»¥è¿›è¡Œå®æˆ˜ï¼šæœ¬èŠ‚é€‰å–12306ç«è½¦è´­ç¥¨ä½œä¸ºæ¡ˆä¾‹ï¼Œç”¨è‡ªåŠ¨åŒ–æµ‹è¯•å·¥å…·seleniumå®ç°è‡ªåŠ¨è®¿é—®ç½‘é¡µå¹¶ä¸‹å•ç­‰å¾…è´­ç¥¨ã€‚

**2023-01-20æ›´æ–°:å®Œå–„äº†å…¨éƒ¨åŠŸèƒ½å¹¶å¯ä»¥å®Œæ•´è¿è¡Œ**

* * *

### ç›®çš„

æ‰‹åŠ¨åœ¨æ§åˆ¶å°è¾“å…¥ä¹˜è½¦äºº(æ–°å¢), å‡ºå‘åœ°ã€ç›®çš„åœ°ã€å‡ºå‘æ—¥ã€æ˜¯å¦è´­ä¹°å­¦ç”Ÿç¥¨ï¼Œç¡®è®¤åè‡ªåŠ¨è·³è½¬12306ç½‘ç«™è´­ç¥¨ã€‚

* * *

### æ€è·¯

1\. é¦–å…ˆè·å–ç™»é™†é¡µé¢çš„URLï¼Œéšåå®šä½è´¦å·å¯†ç çš„è¾“å…¥æ¡†ï¼Œç”¨sendkeyæ¥å£è¾“å…¥ä¸ªäººä¿¡æ¯ï¼›

2\. è·å–ç™»å½•æ§ä»¶çš„XPATHåœ°å€ï¼Œç‚¹å‡»å‘ç°å¼¹çª—å‡ºç°æ»‘å—éªŒè¯ï¼Œä½¿ç”¨drag_and_drop_by_offsetæ¥å£å®ç°æ‹–æ‹½æ»‘å—åˆ°ç»ˆç‚¹çš„æ“ä½œï¼›

3\. ç™»é™†ä»¥åé»˜è®¤åœ¨ä¸ªäººä¸­å¿ƒï¼Œè·å–è´­ç¥¨æŒ‰é’®XPATHåœ°å€ï¼Œç‚¹å‡»è®¿é—®ï¼›

4\. åˆ†æè´­ç¥¨ç•Œé¢ï¼Œç‚¹å‡»æ–‡æœ¬æ¡†ä»¥åå¯ä»¥æ¸…ç©ºå½“å‰æ–‡æœ¬æ¡†ï¼Œæ‰€ä»¥åŠ¨ä½œé“¾åº”å½“ä¸ºï¼šç‚¹å‡» -> è¾“å…¥ -> æŒ‰ä¸‹å›è½¦ã€‚å› ä¸ºè¾“å…¥ä»¥åä¼šå¼¹å‡ºé€‰é¡¹ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜å¾—ç‚¹ä¸€ä¸‹å›è½¦ï¼Œç›´æ¥åˆ‡æ¢å…¶ä»–æ–‡æœ¬æ¡†ä¼šæ¸…ç©ºï¼›

5\. å‡ºå‘æ—¥æ–‡æœ¬æ¡†ç‚¹å‡»çš„æ—¶å€™ä¸ä¼šæ¸…ç©ºï¼Œæ‰€ä»¥ç”¨clearæ¥å£æ¸…ç©ºæ–‡æœ¬æ¡†ï¼Œç„¶åè¾“å…¥æ­£ç¡®çš„æ—¥æœŸæ ¼å¼yyyy-mm-ddå½¢å¼ï¼›

6\. å¦‚æœæ˜¯å­¦ç”Ÿç¥¨ï¼Œåˆ‡æ¢å­¦ç”Ÿç¥¨ï¼›

7\. ç‚¹å‡»æŸ¥è¯¢ï¼Œæ‹¿åˆ°å¯é¢„å®šè½¦ç¥¨åˆ—è¡¨ï¼›

8\. ç”¨**æ˜¾ç¤ºç­‰å¾…** å®šä½é¢„å®šæŒ‰é’®ï¼Œç‚¹å‡»è·³è½¬è´­ç¥¨é¡µé¢ï¼›

9\. ç”¨**æ¡ä»¶ç­‰å¾…** é€‰æ‹©å­¦ç”Ÿä¹˜å®¢ï¼Œå¹¶åœ¨å¼¹çª—ä¸­ç¡®è®¤è´­ä¹°å­¦ç”Ÿç¥¨ ; æˆ–ç›´æ¥é€‰æ‹©ä¸€èˆ¬ä¹˜å®¢è´­ç¥¨ï¼›

10\. æäº¤è®¢å•ï¼Œç­‰å¾…ä»˜æ¬¾ã€‚

* * *

### ä»£ç å®ç°

#### 1\. è¿›å…¥ç™»å½•ç•Œé¢ï¼Œè¾“å…¥è´¦å·å¯†ç 

```python opt = Options() # option.add_experimental_option('excludeSwitches', ['enable-automation']) opt.add_argument('--disable-blink-features=AutomationControlled') opt.add_experimental_option('detach', True) opt.add_argument('--start-maximized') # æµè§ˆå™¨çª—å£æœ€å¤§ web = Chrome(options=opt) web.get("https://kyfw.12306.cn/otn/resources/login.html") web.find_element(By.XPATH, '//*[@id="toolbar_Div"]/div[2]/div[2]/ul/li[1]/a').click() time.sleep(1) # TODO è¾“å…¥ç”¨æˆ·åå’Œå¯†ç  web.find_element(By.XPATH, '//*[@id="J-userName"]').send_keys("username") web.find_element(By.XPATH, '//*[@id="J-password"]').send_keys("password") ``` 

#### 2\. ç‚¹å‡»ç™»å½•æŒ‰é’®ï¼Œå®Œæˆæ»‘å—éªŒè¯

```python # ç‚¹å‡»ç™»å½• web.find_element(By.XPATH, '//*[@id="J-login"]').click() time.sleep(3) # æ‹–æ‹½ btn = web.find_element(By.XPATH, '//*[@id="nc_1_n1z"]') ActionChains(web).drag_and_drop_by_offset(btn, 300, 0).perform() time.sleep(3) ``` 

ActionChainsé‡Œé¢æœ‰è®¸å¤šåŠ¨ä½œåºåˆ—ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬å®Œæˆè®¸å¤šä»¿äººç±»åŠ¨ä½œï¼Œ**è®°å¾—åœ¨æœ€ååŠ perform** ï¼Œä¸ç„¶åŠ¨ä½œåºåˆ—æ˜¯ä¸ä¼šæ‰§è¡Œçš„ã€‚

#### 3\. åœ¨ä¸ªäººä¸­å¿ƒç‚¹å‡»è´­ç¥¨ï¼Œè·³è½¬

```python # è½¦ç¥¨é¢„å®š web.find_element(By.XPATH, '//*[@id="link_for_ticket"]').click() ``` 

#### 4\. è¾“å…¥å‡ºå‘åœ°ã€ç›®çš„åœ°ï¼Œä»æ§åˆ¶å°è¾“å…¥å¾—åˆ°

ä»æ§åˆ¶å°è·å¾—ä¿¡æ¯ï¼š

**æ›´æ–° : å¢åŠ äº†ä¹˜è½¦äºº,ä¾¿äºå®šä½åç»­è´­ç¥¨äºº**

```python # åˆå§‹åŒ–è´­ç¥¨ä¿¡æ¯ print("***æ¬¢è¿ä½¿ç”¨è‡ªåŠ¨è´­ç¥¨ç³»ç»Ÿ***") print("è¯·ä¾æ¬¡è¾“å…¥è´­ç¥¨ä¿¡æ¯...") print("=" * 30) fromStationText = input("è¯·è¾“å…¥å‡ºå‘åœ°ï¼ˆç¤ºä¾‹ï¼šä»‹ä¼‘ä¸œï¼‰...\n") toStationText = input("è¯·è¾“å…¥ç›®çš„åœ°ï¼ˆç¤ºä¾‹ï¼šæˆéƒ½ä¸œï¼‰...\n") train_date = input("è¯·è¾“å…¥å‡ºå‘æ—¥ï¼ˆç¤ºä¾‹ï¼š2023-01-19ï¼‰...\n") is_student = input("æ˜¯å¦è´­ä¹°å­¦ç”Ÿç¥¨ï¼Ÿï¼ˆy/nï¼‰\n") print("=" * 30) print("å¤„ç†ä¿¡æ¯ä¸­...\n", "å¤„ç†å®Œæ¯•ï¼Œè¯·æ£€æŸ¥æ‚¨è¾“å…¥çš„ä¿¡æ¯...\n", fromStationText, toStationText, train_date) confirm = input("æ˜¯å¦ç¡®è®¤ä¸Šè¿°ä¿¡æ¯ï¼Ÿï¼ˆy/nï¼‰\n") if confirm == 'y': print("=" * 30) print("åˆå§‹åŒ–å®Œæ¯•ï¼Œå¼€å§‹è¿è¡Œç³»ç»Ÿ...") if confirm == 'n': print("=" * 30) print("è¯·é‡æ–°è¿è¡Œç¨‹åºï¼") exit(1) ``` 

ä¿®æ”¹ï¼šå¯ä»¥ç²¾ç®€sendkeysæ“ä½œï¼Œå°†å®ƒä»¬æ”¾å…¥ä¸€è¡Œï¼šå°†ä¿¡æ¯è¾“å…¥æ–‡æœ¬æ¡†ï¼š

```python # è¾“å…¥ä¿¡æ¯ï¼ˆå‡ºå‘åœ°ã€ç›®çš„åœ°ã€å‡ºå‘æ—¥ï¼‰ # å‡ºå‘åœ° web.find_element(By.XPATH, '//*[@id="fromStationText"]').click() web.find_element(By.XPATH, '//*[@id="fromStationText"]').send_keys(fromStationText, Keys.ENTER) time.sleep(1) # ç›®çš„åœ° web.find_element(By.XPATH, '//*[@id="toStationText"]').click() web.find_element(By.XPATH, '//*[@id="toStationText"]').send_keys(toStationText, Keys.ENTER) time.sleep(1) ``` 

#### 5\. æ–‡æœ¬æ¡†è¾“å…¥å‡ºå‘æ—¥

```python # å‡ºå‘æ—¥ # date = web.find_element(By.XPATH, '//*[@id="train_date"]') # ActionChains(web).drag_and_drop_by_offset(date, 175, 0).perform() web.find_element(By.XPATH, '//*[@id="train_date"]').clear() web.find_element(By.XPATH, '//*[@id="train_date"]').send_keys(train_date) time.sleep(1) ``` 

#### 6\. è‹¥æ˜¯å­¦ç”Ÿç¥¨åˆ™åˆ‡æ¢ç¥¨å‹

```python # ç‚¹å‡»æŸ¥è¯¢ if is_student == 'y': web.find_element(By.XPATH, '//*[@id="sf2_label"]').click() time.sleep(1) ``` 

#### 7\. ç‚¹å‡»æŸ¥è¯¢

```python # ç‚¹å‡»æŸ¥è¯¢ web.find_element(By.XPATH, '//*[@id="query_ticket"]').click() print("=" * 30) print("æŸ¥è¯¢å®Œæ¯•...") time.sleep(1) ``` 

#### 8\. å®šä½é¢„å®šæŒ‰é’®ï¼Œç‚¹å‡»è·³è½¬è´­ç¥¨é¡µé¢

å®šä½æ€è·¯æœ‰ä¸¤ç§ï¼Œä¸€ä¸ªæ˜¯**ç›´æ¥æ‰¾åˆ°æ§ä»¶** ï¼Œå¦ä¸€ä¸ªæ˜¯**ç›¸å¯¹æŸ¥æ‰¾** ï¼Œè¿™é‡Œæˆ‘é€‰ç”¨ç¬¬äºŒç§ã€‚ç”±äºç¬¬ä¸€ç§çš„æ§ä»¶åœ°å€éšè—è¾ƒæ·±ï¼Œæ— æ³•ç›´æ¥åœ¨æºä»£ç å®šä½ï¼Œè—åœ¨jsé‡Œé¢ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥**ç”¨æ ‡å¤´çš„æœ€åä¸€é¡¹ç›¸å¯¹æŸ¥æ‰¾** å°±è¡Œäº†ã€‚

```python # ç‚¹å‡»é¢„å®š # TODO å¾…åŠï¼šå®šä½é¢„è®¢æ§ä»¶ get_ticket = web.find_element(By.XPATH, '//*[@id="float"]/th[16]') ActionChains(web).move_to_element_with_offset(get_ticket, 55, 70).click().perform() ``` 

ä½†æ˜¯è¿™æ ·å¾ˆéš¾ç²¾å‡†å®šä½ï¼Œä¸èƒ½é€‚ç”¨æ‰€æœ‰ç½‘é¡µï¼Œæ‰€ä»¥è¿˜æ˜¯å®è·µç¬¬ä¸€ç§æ–¹æ³•ï¼šæ‰¾åˆ°æ§ä»¶ï¼š

**æœ€ç»ˆç¡®è®¤æ–¹æ³•ï¼š æ˜¾ç¤ºç­‰å¾…**

```python # ç‚¹å‡»é¢„å®š WebDriverWait(web, 1000).until(EC.presence_of_element_located((By.XPATH, '//*[@id="queryLeftTable"]/tr'))) tr_list = web.find_elements(By.XPATH, '//*[@id="queryLeftTable"]/tr[not(@datatran)]') # æ¯ä¸€åˆ—åˆ—è½¦æ•´è¡Œä¿¡æ¯åˆ—è¡¨ï¼Œåˆ—è½¦å·å…ƒç´ æ˜¯trçš„å­å…ƒç´  if not tr_list: print("=" * 30) print(f"å¾ˆæŠ±æ­‰ï¼ŒæŒ‰æ‚¨çš„æŸ¥è¯¢æ¡ä»¶ï¼Œå½“å‰æœªæ‰¾åˆ°ä»{fromStationText}åˆ°{toStationText}çš„åˆ—è½¦ã€‚") exit(1) for tr in tr_list: train_num = tr.find_element(By.XPATH, './td[1]/div/div[1]/div/a').text # å–å‡ºå…ƒç´ tré‡Œçš„åˆ—è½¦å· # åŠ¨è½¦äºŒç­‰åº§ä½™ç¥¨ä¿¡æ¯ text_1 = tr.find_element(By.XPATH, "./td[4]").text # ç«è½¦äºŒç­‰åº§ä½™ç¥¨ä¿¡æ¯ text_2 = tr.find_element(By.XPATH, "./td[8]").text if (text_1 == "æœ‰" or text_1.isdigit()) or (text_2 == "æœ‰" or text_2.isdigit()): # ç‚¹å‡»é¢„è®¢æŒ‰é’® order_btn = tr.find_element(By.CLASS_NAME, "btn72") order_btn.click() # ç­‰å¾…è®¢ç¥¨é¡µé¢ WebDriverWait(web, 1000).until(EC.url_to_be('https://kyfw.12306.cn/otn/confirmPassenger/initDc')) print("=" * 30) print(train_num, "äºŒç­‰åº§æœ‰ç¥¨ï¼") break else: print("=" * 30) print(train_num, "äºŒç­‰åº§æ— ç¥¨ï¼") continue ``` 

#### 9\. é€‰æ‹©å­¦ç”Ÿä¹˜å®¢ï¼Œå¹¶åœ¨å¼¹çª—ä¸­ç¡®è®¤è´­ä¹°å­¦ç”Ÿç¥¨

ä¿®æ”¹ï¼šç”¨expected conditionï¼ˆECï¼‰é€‰å–å¤„ç†å¼¹çª—äº‹ä»¶ã€‚

```python # è·³è½¬é¡µé¢æäº¤è®¢å• # é€‰å®šä¹˜è½¦äºº web.find_element(By.XPATH, f'//*[@id="normal_passenger_id"]/li/label[contains(text(),"{passenger}")]').click() # å¦‚æœä¹˜å®¢æ˜¯å­¦ç”Ÿï¼Œå¯¹æç¤ºç‚¹å‡»ç¡®å®š if EC.presence_of_element_located((By.XPATH, '//div[@id="dialog_xsertcj"]')): web.find_element(By.ID, 'dialog_xsertcj_ok').click() # æäº¤è®¢å• web.find_element(By.ID, 'submitOrder_id').click() time.sleep(2) else: # æäº¤è®¢å• web.find_element(By.ID, 'submitOrder_id').click() time.sleep(2) ``` 

#### 10\. æäº¤è®¢å•ï¼Œç­‰å¾…ä»˜æ¬¾

ä¿®æ”¹ï¼šæ›´æ–°äº†åº§ä½IDæ— æ³•æ‰¾åˆ°çš„é—®é¢˜ï¼Œå‘ä¸Šå®šä½XPATHå†å¾€åç¡®è®¤

```python # é€‰åº§ print("=" * 30) seat = input("è¯·å°½å¿«è¿›è¡Œé€‰åº§æ“ä½œï¼ˆ[çª—]A/B/C/[è¿‡é“]/D/F[çª—]ï¼‰\n") if seat == 'A': web.find_element(By.XPATH, '//*[@id="erdeng1"]/ul[1]/li[1]/a').click() if seat == 'B': web.find_element(By.XPATH, '//*[@id="erdeng1"]/ul[1]/li[2]/a').click() if seat == 'C': web.find_element(By.XPATH, '//*[@id="erdeng1"]/ul[1]/li[3]/a').click() if seat == 'D': web.find_element(By.XPATH, '//*[@id="erdeng1"]/ul[2]/li[1]/a').click() if seat == 'F': web.find_element(By.XPATH, '//*[@id="erdeng1"]/ul[2]/li[2]/a').click() # æœ€ç»ˆç¡®è®¤ web.find_element(By.XPATH, '//*[@id="qr_submit_id"]').click() print("=" * 30) print("*"*40, "\n---***<|è®¢å•åˆ›å»ºå®Œæˆï¼Œè¯·äº10åˆ†é’Ÿå†…ä»˜æ¬¾|>***---") print("*"*40) ``` 

* * *

### å®Œæ•´ä»£ç 

```python from selenium.webdriver import Chrome from selenium.webdriver.common.action_chains import ActionChains from selenium.webdriver.chrome.options import Options from selenium.webdriver.common.by import By from selenium.webdriver.common.keys import Keys from selenium.webdriver.support.wait import WebDriverWait from selenium.webdriver.support import expected_conditions as EC import time # åˆå§‹åŒ–è´­ç¥¨ä¿¡æ¯ print("***æ¬¢è¿ä½¿ç”¨è‡ªåŠ¨è´­ç¥¨ç³»ç»Ÿ***") print("è¯·ä¾æ¬¡è¾“å…¥è´­ç¥¨ä¿¡æ¯...") print("=" * 30) passenger = input("è¯·è¾“å…¥ä¹˜è½¦äººï¼ˆç¤ºä¾‹ï¼šè”¡å¾å¤ï¼‰...\n") fromStationText = input("è¯·è¾“å…¥å‡ºå‘åœ°ï¼ˆç¤ºä¾‹ï¼šä»‹ä¼‘ä¸œï¼‰...\n") toStationText = input("è¯·è¾“å…¥ç›®çš„åœ°ï¼ˆç¤ºä¾‹ï¼šæˆéƒ½ä¸œï¼‰...\n") train_date = input("è¯·è¾“å…¥å‡ºå‘æ—¥ï¼ˆç¤ºä¾‹ï¼š2023-01-19ï¼‰...\n") is_student = input("æ˜¯å¦è´­ä¹°å­¦ç”Ÿç¥¨ï¼Ÿï¼ˆy/nï¼‰\n") print("=" * 30) print("å¤„ç†ä¿¡æ¯ä¸­...\n", "å¤„ç†å®Œæ¯•ï¼Œè¯·æ£€æŸ¥æ‚¨è¾“å…¥çš„ä¿¡æ¯...\n", fromStationText, toStationText, train_date) confirm = input("æ˜¯å¦ç¡®è®¤ä¸Šè¿°ä¿¡æ¯ï¼Ÿï¼ˆy/nï¼‰\n") if confirm == 'y': print("=" * 30) print("åˆå§‹åŒ–å®Œæ¯•ï¼Œå¼€å§‹è¿è¡Œç³»ç»Ÿ...") if confirm == 'n': print("=" * 30) print("è¯·é‡æ–°è¿è¡Œç¨‹åºï¼") exit(1) # 2.chromeçš„ç‰ˆæœ¬å¤§äºç­‰äº88 opt = Options() # option.add_experimental_option('excludeSwitches', ['enable-automation']) opt.add_argument('--disable-blink-features=AutomationControlled') opt.add_experimental_option('detach', True) opt.add_argument('--start-maximized') # æµè§ˆå™¨çª—å£æœ€å¤§ web = Chrome(options=opt) web.get("https://kyfw.12306.cn/otn/resources/login.html") web.find_element(By.XPATH, '//*[@id="toolbar_Div"]/div[2]/div[2]/ul/li[1]/a').click() time.sleep(1) # TODO è¾“å…¥ç”¨æˆ·åå’Œå¯†ç  web.find_element(By.XPATH, '//*[@id="J-userName"]').send_keys("18306825490") web.find_element(By.XPATH, '//*[@id="J-password"]').send_keys("lk020511") # ç‚¹å‡»ç™»å½• web.find_element(By.XPATH, '//*[@id="J-login"]').click() time.sleep(3) # æ‹–æ‹½ btn = web.find_element(By.XPATH, '//*[@id="nc_1_n1z"]') ActionChains(web).drag_and_drop_by_offset(btn, 300, 0).perform() time.sleep(3) # è½¦ç¥¨é¢„å®š web.find_element(By.XPATH, '//*[@id="link_for_ticket"]').click() # è¾“å…¥ä¿¡æ¯ï¼ˆå‡ºå‘åœ°ã€ç›®çš„åœ°ã€å‡ºå‘æ—¥ï¼‰ # å‡ºå‘åœ° web.find_element(By.XPATH, '//*[@id="fromStationText"]').click() web.find_element(By.XPATH, '//*[@id="fromStationText"]').send_keys(fromStationText, Keys.ENTER) time.sleep(1) # ç›®çš„åœ° web.find_element(By.XPATH, '//*[@id="toStationText"]').click() web.find_element(By.XPATH, '//*[@id="toStationText"]').send_keys(toStationText, Keys.ENTER) time.sleep(1) # å‡ºå‘æ—¥ web.find_element(By.XPATH, '//*[@id="train_date"]').clear() web.find_element(By.XPATH, '//*[@id="train_date"]').send_keys(train_date) time.sleep(1) # ç‚¹å‡»æŸ¥è¯¢ if is_student == 'y': web.find_element(By.XPATH, '//*[@id="sf2_label"]').click() time.sleep(1) web.find_element(By.XPATH, '//*[@id="query_ticket"]').click() print("=" * 30) print("æŸ¥è¯¢å®Œæ¯•...") time.sleep(1) # ç‚¹å‡»é¢„å®š WebDriverWait(web, 1000).until(EC.presence_of_element_located((By.XPATH, '//*[@id="queryLeftTable"]/tr'))) tr_list = web.find_elements(By.XPATH, '//*[@id="queryLeftTable"]/tr[not(@datatran)]') # æ¯ä¸€åˆ—åˆ—è½¦æ•´è¡Œä¿¡æ¯åˆ—è¡¨ï¼Œåˆ—è½¦å·å…ƒç´ æ˜¯trçš„å­å…ƒç´  if not tr_list: print("=" * 30) print(f"å¾ˆæŠ±æ­‰ï¼ŒæŒ‰æ‚¨çš„æŸ¥è¯¢æ¡ä»¶ï¼Œå½“å‰æœªæ‰¾åˆ°ä»{fromStationText}åˆ°{toStationText}çš„åˆ—è½¦ã€‚") exit(1) for tr in tr_list: train_num = tr.find_element(By.XPATH, './td[1]/div/div[1]/div/a').text # å–å‡ºå…ƒç´ tré‡Œçš„åˆ—è½¦å· # åŠ¨è½¦äºŒç­‰åº§ä½™ç¥¨ä¿¡æ¯ text_1 = tr.find_element(By.XPATH, "./td[4]").text # ç«è½¦äºŒç­‰åº§ä½™ç¥¨ä¿¡æ¯ text_2 = tr.find_element(By.XPATH, "./td[8]").text if (text_1 == "æœ‰" or text_1.isdigit()) or (text_2 == "æœ‰" or text_2.isdigit()): # ç‚¹å‡»é¢„è®¢æŒ‰é’® order_btn = tr.find_element(By.CLASS_NAME, "btn72") order_btn.click() # ç­‰å¾…è®¢ç¥¨é¡µé¢ WebDriverWait(web, 1000).until(EC.url_to_be('https://kyfw.12306.cn/otn/confirmPassenger/initDc')) print("=" * 30) print(train_num, "äºŒç­‰åº§æœ‰ç¥¨ï¼") break else: print("=" * 30) print(train_num, "äºŒç­‰åº§æ— ç¥¨ï¼") continue # è·³è½¬é¡µé¢æäº¤è®¢å• # é€‰å®šä¹˜è½¦äºº web.find_element(By.XPATH, f'//*[@id="normal_passenger_id"]/li/label[contains(text(),"{passenger}")]').click() # å¦‚æœä¹˜å®¢æ˜¯å­¦ç”Ÿï¼Œå¯¹æç¤ºç‚¹å‡»ç¡®å®š if EC.presence_of_element_located((By.XPATH, '//div[@id="dialog_xsertcj"]')): web.find_element(By.ID, 'dialog_xsertcj_ok').click() # æäº¤è®¢å• web.find_element(By.ID, 'submitOrder_id').click() time.sleep(2) else: # æäº¤è®¢å• web.find_element(By.ID, 'submitOrder_id').click() time.sleep(2) # é€‰åº§ print("=" * 30) seat = input("è¯·å°½å¿«è¿›è¡Œé€‰åº§æ“ä½œï¼ˆ[çª—]A/B/C/[è¿‡é“]/D/F[çª—]ï¼‰\n") if seat == 'A': web.find_element(By.XPATH, '//*[@id="erdeng1"]/ul[1]/li[1]/a').click() if seat == 'B': web.find_element(By.XPATH, '//*[@id="erdeng1"]/ul[1]/li[2]/a').click() if seat == 'C': web.find_element(By.XPATH, '//*[@id="erdeng1"]/ul[1]/li[3]/a').click() if seat == 'D': web.find_element(By.XPATH, '//*[@id="erdeng1"]/ul[2]/li[1]/a').click() if seat == 'F': web.find_element(By.XPATH, '//*[@id="erdeng1"]/ul[2]/li[2]/a').click() # æœ€ç»ˆç¡®è®¤ web.find_element(By.XPATH, '//*[@id="qr_submit_id"]').click() print("=" * 30) print("*"*40, "\n---***<|è®¢å•åˆ›å»ºå®Œæˆï¼Œè¯·äº10åˆ†é’Ÿå†…ä»˜æ¬¾|>***---") print("*"*40) ``` 

* * *

### è¿è¡Œæ•ˆæœ

![](/images/posts/28.-å®æˆ˜ï¼šåŸºäºseleniumå®ç°12306è‡ªåŠ¨è´­ç¥¨/6dbf8c615639.png)

![](/images/posts/28.-å®æˆ˜ï¼šåŸºäºseleniumå®ç°12306è‡ªåŠ¨è´­ç¥¨/66fbdc39aabf.png)

![](/images/posts/28.-å®æˆ˜ï¼šåŸºäºseleniumå®ç°12306è‡ªåŠ¨è´­ç¥¨/027f52eadef8.png)

![](/images/posts/28.-å®æˆ˜ï¼šåŸºäºseleniumå®ç°12306è‡ªåŠ¨è´­ç¥¨/7ec764af76c7.png)

![](/images/posts/28.-å®æˆ˜ï¼šåŸºäºseleniumå®ç°12306è‡ªåŠ¨è´­ç¥¨/80970b419e47.png)

![](/images/posts/28.-å®æˆ˜ï¼šåŸºäºseleniumå®ç°12306è‡ªåŠ¨è´­ç¥¨/ef45ceb120c6.png)

![](/images/posts/28.-å®æˆ˜ï¼šåŸºäºseleniumå®ç°12306è‡ªåŠ¨è´­ç¥¨/2fbb2700ee22.png)

![](/images/posts/28.-å®æˆ˜ï¼šåŸºäºseleniumå®ç°12306è‡ªåŠ¨è´­ç¥¨/4e94076583e6.png)

![](/images/posts/28.-å®æˆ˜ï¼šåŸºäºseleniumå®ç°12306è‡ªåŠ¨è´­ç¥¨/09a787148650.png)

![](/images/posts/28.-å®æˆ˜ï¼šåŸºäºseleniumå®ç°12306è‡ªåŠ¨è´­ç¥¨/417b1681a1a1.png)

![](/images/posts/28.-å®æˆ˜ï¼šåŸºäºseleniumå®ç°12306è‡ªåŠ¨è´­ç¥¨/64bc76e11779.png)

* * *

### æ€»ç»“

æœ¬èŠ‚æ˜¯åŸºäºseleniumçš„æµè§ˆå™¨è‡ªåŠ¨åŒ–æ“ä½œçš„å®ä¾‹ï¼Œè¾ƒä¸ºç»¼åˆï¼Œæ¶‰åŠçš„çŸ¥è¯†ç‚¹ä¹Ÿæ¯”è¾ƒå¤šï¼Œä»…ä¾›å°ä¼™ä¼´ä»¬å‚è€ƒå­¦ä¹ ï¼Œè¯·å‹¿ç”¨äºå…¶ä»–ç”¨é€”ï¼

ä¸å¤ªæ˜ç™½çš„å°ä¼™ä¼´å¯ä»¥ç§»æ­¥æˆ‘ä¹‹å‰å‘å¸ƒè¿‡çš„[seleniumåŸºç¡€](https://blog.csdn.net/m0_59180666/article/details/128699574?spm=1001.2014.3001.5501 "seleniumåŸºç¡€")å’Œ[ç®€å•çš„éªŒè¯ç å®æˆ˜](https://blog.csdn.net/m0_59180666/article/details/128707095?spm=1001.2014.3001.5501 "ç®€å•çš„éªŒè¯ç å®æˆ˜")
