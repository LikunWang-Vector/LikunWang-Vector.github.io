---
title: "34. å®æˆ˜ï¼šåŸºäºæŸapiå®ç°æ­Œæ›²æ£€ç´¢ä¸ä¸‹è½½ï¼ˆé™„å®Œæ•´æºä»£ç ï¼‰"
date: 2023-01-31
updated: 2023-01-31
categories:
  - Pythonçˆ¬è™«å…¥é—¨ã€è¿›é˜¶ä¸å®æˆ˜
tags:
  - json
  - python
  - éŸ³é¢‘
  - æ•°æ®åˆ†æ
  - åˆå­¦ç»ƒæ‰‹
csdn_views: 1778
csdn_likes: 3
csdn_comments: 15
csdn_favorites: 6
csdn_url: https://blog.csdn.net/m0_59180666/article/details/128812483
cover: /images/posts/34.-å®æˆ˜ï¼šåŸºäºæŸapiå®ç°æ­Œæ›²æ£€ç´¢ä¸ä¸‹è½½ï¼ˆé™„å®Œæ•´æºä»£ç ï¼‰/ba8af8d87d60.png
lang_pair:
  en: "34. Practical: Music Search and Download via API"
---

> æœ¬æ–‡è¿ç§»è‡ªCSDNåšå®¢
> åŸæ–‡é“¾æ¥ï¼š[34. å®æˆ˜ï¼šåŸºäºæŸapiå®ç°æ­Œæ›²æ£€ç´¢ä¸ä¸‹è½½ï¼ˆé™„å®Œæ•´æºä»£ç ï¼‰](https://blog.csdn.net/m0_59180666/article/details/128812483)
> ğŸ“Š 1778 é˜…è¯» | ğŸ‘ 3 ç‚¹èµ | ğŸ’¬ 15 è¯„è®º | â­ 6 æ”¶è—

**ç›®å½•**

å‰è¨€ **ï¼ˆç›¸å…³é“¾æ¥åœ¨è¯„è®ºåŒºï¼‰**

ç›®çš„ **ï¼ˆç›¸å…³é“¾æ¥åœ¨è¯„è®ºåŒºï¼‰**

æ€è·¯ **ï¼ˆç›¸å…³é“¾æ¥åœ¨è¯„è®ºåŒºï¼‰**

ä»£ç å®ç°

1\. è®¿é—®æŸéŸ³ä¹å¹³å°ï¼ˆé“¾æ¥æ”¾åœ¨è¯„è®ºåŒºäº†ï¼‰ï¼ŒæŠ“åŒ…æœç´¢æ¥å£

2\. æŠ“å–éŸ³ä¹idä¿¡æ¯

3\. è§£æéŸ³ä¹idï¼Œè·å–ä¸‹è½½ç›´é“¾

4\. ä¿å­˜åˆ°æœ¬åœ°

5\. å®ç°ç”¨æˆ·äº¤äº’é€»è¾‘

å®Œæ•´ä»£ç 

è¿è¡Œæ•ˆæœ

æ€»ç»“

* * *

### å‰è¨€

æœ¬èŠ‚å°†ä»‹ç»åŸºäºPythonå’ŒæŸapiå®ç°çš„æ­Œæ›²æ£€ç´¢ä¸æ‰¹é‡ä¸‹è½½åŠŸèƒ½çš„å®ç°ã€‚

**ï¼ˆç›¸å…³é“¾æ¥åœ¨è¯„è®ºåŒºï¼‰**

* * *

### ç›®çš„

å®ç°æœç´¢ä»»æ„å…³é”®è¯ï¼Œé€‰æ‹©ä»»æ„åºå·æ­Œæ›²ä¸‹è½½æˆ–ä¸‹è½½å½“é¡µå…¨éƒ¨æ­Œæ›²ã€‚

* * *

### æ€è·¯

1\. è®¿é—®æŸéŸ³ä¹å¹³å°**ï¼ˆé“¾æ¥æ”¾åœ¨è¯„è®ºåŒºäº†ï¼‰** ï¼ŒæŠ“åŒ…æœç´¢æ¥å£

2\. æŠ“å–éŸ³ä¹idä¿¡æ¯

3\. è§£æéŸ³ä¹idï¼Œè·å–ä¸‹è½½ç›´é“¾

4\. ä¿å­˜åˆ°æœ¬åœ°

5\. å®ç°ç”¨æˆ·äº¤äº’é€»è¾‘

* * *

### ä»£ç å®ç°

#### 1\. è®¿é—®æŸéŸ³ä¹å¹³å°**ï¼ˆé“¾æ¥æ”¾åœ¨è¯„è®ºåŒºäº†ï¼‰** ï¼ŒæŠ“åŒ…æœç´¢æ¥å£

![](/images/posts/34.-å®æˆ˜ï¼šåŸºäºæŸapiå®ç°æ­Œæ›²æ£€ç´¢ä¸ä¸‹è½½ï¼ˆé™„å®Œæ•´æºä»£ç ï¼‰/ba8af8d87d60.png)

æŸ¥çœ‹æºä»£ç ï¼Œå‘ç°æ²¡æœ‰æ•°æ®ï¼Œæ‰€ä»¥æŠ“åŒ…ã€‚

**F12 -- > Network --> Fetch/XHR --> åˆ·æ–°ç½‘é¡µ**

![](/images/posts/34.-å®æˆ˜ï¼šåŸºäºæŸapiå®ç°æ­Œæ›²æ£€ç´¢ä¸ä¸‹è½½ï¼ˆé™„å®Œæ•´æºä»£ç ï¼‰/3b0d9ebe6c9b.png)

æ‹¿åˆ°è¯·æ±‚æœç´¢åˆ—è¡¨çš„URLï¼Œä»¥åŠä¸¤ä¸ªå…³é”®å‚æ•°ï¼š

![](/images/posts/34.-å®æˆ˜ï¼šåŸºäºæŸapiå®ç°æ­Œæ›²æ£€ç´¢ä¸ä¸‹è½½ï¼ˆé™„å®Œæ•´æºä»£ç ï¼‰/65ca41951bd8.png)

![](/images/posts/34.-å®æˆ˜ï¼šåŸºäºæŸapiå®ç°æ­Œæ›²æ£€ç´¢ä¸ä¸‹è½½ï¼ˆé™„å®Œæ•´æºä»£ç ï¼‰/e4c48ecd1a7f.png)

```python headers = { 'Cookie': '_ga=GA1.2.1574857442.1641026894; _gid=GA1.2.607461508.1641026894; kw_token=WRFKXNRRLBB', 'csrf': 'WRFKXNRRLBB', 'Host': 'è§è¯„è®ºåŒº', 'Referer': 'è§è¯„è®ºåŒº', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.110 Safari/537.36' } ``` ```python # è¾“å…¥å…³é”®å‚æ•° key = input('è¯·è¾“å…¥æœç´¢å…³é”®è¯ï¼š') pn = input('è¯·è¾“å…¥æŸ¥çœ‹é¡µåºå·ï¼š') # æœç´¢æ¥å£ï¼Œkeyä¸ºå…³é”®è¯ï¼Œpnä¸ºé¡µç  url = 'è§è¯„è®ºåŒº'.format(key, pn) resp = requests.get(url, headers=headers) # pprint(resp.json()) ``` 

å› ä¸ºè¿”å›ç»“æœæ˜¯jsonå½¢å¼çš„æ•°æ®ï¼Œç”¨jsonåº“è§£æï¼Œæ‹¿å‡ºå¿…è¦çš„ä¿¡æ¯ï¼Œç»™æ­Œæ›²ç¼–å·ï¼ˆæ²¡æœ‰ç¼–å·é”®ï¼‰

```python # è¾“å‡ºæœç´¢ç»“æœ cnt = 1 data_list = resp.json()['data']['list'] for i in data_list: name = i['name'].replace('&nbsp;', ' ') i['name'] = name artist = i['artist'].replace('&nbsp;', ' ') i['artist'] = artist i['seq'] = cnt cnt += 1 print('åºå·ï¼š', i['seq'], 'æ­Œæ›²ï¼š', i['name'], 'æ­Œæ‰‹ï¼š', i['artist'], '\n') ``` 

#### 2\. æŠ“å–éŸ³ä¹idä¿¡æ¯

```python # æ‹¿åˆ°æ­Œæ›²idä¾¿äºè§£æ rid = request_dic['rid'] ``` 

ridæ˜¯æˆ‘ä»¬å¿…è¦çš„ä¿¡æ¯ã€‚

æˆ‘ä»¬åœ¨æŸç›´é“¾ç½‘ç«™å¯ä»¥ç”¨ridæ¥æå–å®ƒæ‰€å¯¹åº”çš„ç›´é“¾ä¸‹è½½åœ°å€**ï¼ˆç›¸å…³é“¾æ¥åœ¨è¯„è®ºåŒºï¼‰**

![](/images/posts/34.-å®æˆ˜ï¼šåŸºäºæŸapiå®ç°æ­Œæ›²æ£€ç´¢ä¸ä¸‹è½½ï¼ˆé™„å®Œæ•´æºä»£ç ï¼‰/a4d18504c27d.png)

#### 3\. è§£æéŸ³ä¹idï¼Œè·å–ä¸‹è½½ç›´é“¾

```python for data in download_list: # æŠŠå­—ç¬¦ä¸²è½¬æ¢ä¸ºåè¿›åˆ¶æ•´æ•°ç”¨äºé€‰æ‹©åˆ—è¡¨æ•°æ® if flag: data = int(data, 10) # é€ä¸ªæ‹¿é€‰ä¸­æ­Œæ›²çš„å­—å…¸ request_dic = data_list[data-1] # æ‹¿åˆ°æ­Œæ›²idä¾¿äºè§£æ rid = request_dic['rid'] # print(rid) # ç¨å¾®å¤„ç†ä¸€ä¸‹æ›²å name = request_dic['name'].split('-')[0] # print(name) new_url = 'è§è¯„è®ºåŒº'.format(rid) response = requests.get(new_url) ``` 

å¦‚æœæ²¡æœ‰å…¨éƒ¨ä¸‹è½½çš„è¯ï¼Œæˆ‘ä»¬å°±éœ€è¦æŠŠè¾“å…¥çš„å­—ç¬¦ä¸²è½¬ä¸ºæ•°å­—ä¾¿äºé€‰æ‹©æ­Œæ›²åºå·ï¼Œæ‹¿åˆ°ridå¹¶ä¸”å¤„ç†ä¸€ä¸‹æ›²åï¼Œå› ä¸ºæœ‰äº›æ›²åä¼šåœ¨â€œ-â€åé¢åŠ ä¸Šä¸€äº›æ¥æºï¼Œæ¯”å¦‚xxxç‰‡å¤´æ›²ä¹‹ç±»ï¼Œæˆ‘ä»¬æ˜¯ä¸éœ€è¦çš„ï¼Œæ‰€ä»¥ç›´æ¥splitåˆ†å‰²å–ç¬¬ä¸€ä¸ªã€‚

new_urlå°±æ˜¯ç›´æ¥æŠŠridå¡è¿›å»ï¼Œå°±æ˜¯å¯¹åº”çš„ç›´é“¾åœ°å€äº†ã€‚ 

#### 4\. ä¿å­˜åˆ°æœ¬åœ°

```python if not os.path.exists('./3_Music_Crawler'): os.mkdir('./3_Music_Crawler') with open('3_Music_Crawler/%s.mp3' % name, 'wb') as f: f.write(response.content) print(name, 'ä¸‹è½½æˆåŠŸ') ``` 

å¦‚æœæ²¡æœ‰æŸè·¯å¾„ï¼Œä¾¿åˆ›å»ºå®ƒï¼Œè¿™æ˜¯åŸºäºosåº“å®ç°çš„ï¼Œå¯¼åŒ…å³å¯ã€‚

å°†ç›´é“¾ä¸­çš„æ•°æ®äºŒè¿›åˆ¶å†™å…¥æœ¬åœ°æ–‡ä»¶ï¼Œç”¨æ­Œæ›²åå‘½åï¼Œåç¼€ä¸ºMP3æ ¼å¼ã€‚ 

#### 5\. å®ç°ç”¨æˆ·äº¤äº’é€»è¾‘

é¦–å…ˆå°±æ˜¯è¦å…ˆè¾“å…¥å…³é”®å‚æ•°ï¼šè¾“å…¥å…³é”®è¯ä¸æŸ¥è¯¢é¡µç ï¼Œæ¯é¡µä¸­çš„æ•°æ®é‡ä¸å¿…æ”¹å˜ï¼Œé»˜è®¤æ˜¯20æ¡ã€‚

```python # è¾“å…¥å…³é”®å‚æ•° key = input('è¯·è¾“å…¥æœç´¢å…³é”®è¯ï¼š') pn = input('è¯·è¾“å…¥æŸ¥çœ‹é¡µåºå·ï¼š') ``` 

å‘ç”¨æˆ·è¾“å‡ºæœç´¢ç»“æœï¼Œå¹¶æ‰“å°æ­Œæ›²åºå·å’Œè¯¦ç»†ä¿¡æ¯ï¼Œä¾›ç”¨æˆ·é€‰æ‹©æ˜¯å¦è¿›è¡Œä¸‹è½½ã€‚

```python # è¾“å‡ºæœç´¢ç»“æœ cnt = 1 data_list = resp.json()['data']['list'] for i in data_list: name = i['name'].replace('&nbsp;', ' ') i['name'] = name artist = i['artist'].replace('&nbsp;', ' ') i['artist'] = artist i['seq'] = cnt cnt += 1 print('åºå·ï¼š', i['seq'], 'æ­Œæ›²ï¼š', i['name'], 'æ­Œæ‰‹ï¼š', i['artist'], '\n') ``` 

ç”¨æˆ·è¾“å…¥0æ—¶ï¼Œä¸‹è½½å½“å‰é¡µæ‰€æœ‰æ­Œæ›²ï¼Œä¹Ÿå¯ä»¥è¾“å…¥ä»¥ç©ºæ ¼åˆ†éš”çš„åºå·æ¥ä¸‹è½½å¯¹åº”åºå·çš„æ­Œæ›²ã€‚

```python # é€‰æ‹©æ­Œæ›²ä¸‹è½½ download_list = input('è¯·è¾“å…¥ä½ æƒ³ä¸‹è½½æ­Œæ›²çš„åºå·ï¼ˆç”¨ç©ºæ ¼åˆ†éš”åºå·ï¼Œè¾“å…¥0ä¸‹è½½æœ¬é¡µå…¨éƒ¨ï¼‰ï¼š').split(' ') flag = True if download_list == ['0']: flag = False download_list = [] for it in range(1, len(resp.json()['data']['list']) + 1): download_list.append(it) print('å¼€å§‹ä¸‹è½½...') ``` 

è¿™æ ·æˆ‘ä»¬å°±å®Œæ•´é¡ºä¸‹æ¥æ•´ä¸ªè¿‡ç¨‹äº†ï¼Œæœ€åæˆ‘ä»¬æ¢³ç†ä¸€ä¸‹é€»è¾‘ï¼Œå¥‰ä¸Šå®Œæ•´ä»£ç ï¼š

**ï¼ˆç›¸å…³é“¾æ¥åœ¨è¯„è®ºåŒºï¼‰**

* * *

### å®Œæ•´ä»£ç 

```python import requests from pprint import pprint import os # ä¼ªè£…è¯·æ±‚å¤´ headers = { 'Cookie': '_ga=GA1.2.1574857442.1641026894; _gid=GA1.2.607461508.1641026894; kw_token=WRFKXNRRLBB', 'csrf': 'WRFKXNRRLBB', 'Host': 'è§è¯„è®ºåŒº', 'Referer': 'è§è¯„è®ºåŒº', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.110 Safari/537.36' } # è¾“å…¥å…³é”®å‚æ•° key = input('è¯·è¾“å…¥æœç´¢å…³é”®è¯ï¼š') pn = input('è¯·è¾“å…¥æŸ¥çœ‹é¡µåºå·ï¼š') # æœç´¢æ¥å£ï¼Œkeyä¸ºå…³é”®è¯ï¼Œpnä¸ºé¡µç  url = 'è§è¯„è®ºåŒº'.format(key, pn) resp = requests.get(url, headers=headers) # pprint(resp.json()) # è¾“å‡ºæœç´¢ç»“æœ cnt = 1 data_list = resp.json()['data']['list'] for i in data_list: name = i['name'].replace('&nbsp;', ' ') i['name'] = name artist = i['artist'].replace('&nbsp;', ' ') i['artist'] = artist i['seq'] = cnt cnt += 1 print('åºå·ï¼š', i['seq'], 'æ­Œæ›²ï¼š', i['name'], 'æ­Œæ‰‹ï¼š', i['artist'], '\n') # é€‰æ‹©æ­Œæ›²ä¸‹è½½ download_list = input('è¯·è¾“å…¥ä½ æƒ³ä¸‹è½½æ­Œæ›²çš„åºå·ï¼ˆç”¨ç©ºæ ¼åˆ†éš”åºå·ï¼Œè¾“å…¥0ä¸‹è½½æœ¬é¡µå…¨éƒ¨ï¼‰ï¼š').split(' ') flag = True if download_list == ['0']: flag = False download_list = [] for it in range(1, len(resp.json()['data']['list']) + 1): download_list.append(it) print('å¼€å§‹ä¸‹è½½...') # ä¸‹è½½æ­Œæ›² for data in download_list: # æŠŠå­—ç¬¦ä¸²è½¬æ¢ä¸ºåè¿›åˆ¶æ•´æ•°ç”¨äºé€‰æ‹©åˆ—è¡¨æ•°æ® if flag: data = int(data, 10) # é€ä¸ªæ‹¿é€‰ä¸­æ­Œæ›²çš„å­—å…¸ request_dic = data_list[data-1] # æ‹¿åˆ°æ­Œæ›²idä¾¿äºè§£æ rid = request_dic['rid'] # print(rid) # ç¨å¾®å¤„ç†ä¸€ä¸‹æ›²å name = request_dic['name'].split('-')[0] # print(name) new_url = 'è§è¯„è®ºåŒº'.format(rid) response = requests.get(new_url) if not os.path.exists('./3_Music_Crawler'): os.mkdir('./3_Music_Crawler') with open('3_Music_Crawler/%s.mp3' % name, 'wb') as f: f.write(response.content) print(name, 'ä¸‹è½½æˆåŠŸ') ``` 

* * *

### è¿è¡Œæ•ˆæœ

![](/images/posts/34.-å®æˆ˜ï¼šåŸºäºæŸapiå®ç°æ­Œæ›²æ£€ç´¢ä¸ä¸‹è½½ï¼ˆé™„å®Œæ•´æºä»£ç ï¼‰/4124c2414353.png)

![](/images/posts/34.-å®æˆ˜ï¼šåŸºäºæŸapiå®ç°æ­Œæ›²æ£€ç´¢ä¸ä¸‹è½½ï¼ˆé™„å®Œæ•´æºä»£ç ï¼‰/4bae5f548f48.png)

![](/images/posts/34.-å®æˆ˜ï¼šåŸºäºæŸapiå®ç°æ­Œæ›²æ£€ç´¢ä¸ä¸‹è½½ï¼ˆé™„å®Œæ•´æºä»£ç ï¼‰/6d1384661d0b.png)

* * *

### æ€»ç»“

æœ¬èŠ‚åŸºäºæŸapiè·å–ç›´é“¾ï¼Œåœ¨æŸéŸ³ä¹å¹³å°è·å–æœç´¢åˆ—è¡¨ï¼Œä»è€Œæ‹¿åˆ°éŸ³ä¹å”¯ä¸€çš„ridï¼Œæ›¿æ¢ç›´é“¾ä»è€Œè®¿é—®åˆ°æ­Œæ›²çš„ç›´æ¥ä¸‹è½½é“¾æ¥ã€‚æ•´ä¸ªè¿‡ç¨‹æ¯”è¾ƒç»å…¸ï¼Œé€‚åˆå°ç™½ç»ƒæ‰‹ã€‚
