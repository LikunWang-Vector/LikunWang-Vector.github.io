---
title: "23. å¼‚æ­¥HTTPè¯·æ±‚ä¸aiohttpæ¨¡å—"
date: 2023-01-11
updated: 2023-01-11
categories:
  - Pythonçˆ¬è™«å…¥é—¨ã€è¿›é˜¶ä¸å®æˆ˜
tags:
  - ç½‘ç»œçˆ¬è™«
  - python
  - å¼‚æ­¥HTTPè¯·æ±‚
  - aiohttp
  - asyncio
csdn_views: 463
csdn_likes: 5
csdn_comments: 2
csdn_favorites: 7
csdn_url: https://blog.csdn.net/m0_59180666/article/details/128640512
cover: /images/posts/23.-å¼‚æ­¥HTTPè¯·æ±‚ä¸aiohttpæ¨¡å—/c16b2ea9d2e3.png
lang_pair:
  en: "23. Async HTTP Requests with aiohttp Module"
---

> æœ¬æ–‡è¿ç§»è‡ªCSDNåšå®¢
> åŸæ–‡é“¾æ¥ï¼š[23. å¼‚æ­¥HTTPè¯·æ±‚ä¸aiohttpæ¨¡å—](https://blog.csdn.net/m0_59180666/article/details/128640512)
> ğŸ“Š 463 é˜…è¯» | ğŸ‘ 5 ç‚¹èµ | ğŸ’¬ 2 è¯„è®º | â­ 7 æ”¶è—

**ç›®å½•**

å‰è¨€

aiohttpç®€ä»‹

aiohttpå®‰è£…

aiohttpåº”ç”¨

å…ˆå¯¼åŒ…

æ‹¿åˆ°äº†æ‰¹é‡URL

ä»¿ç…§ä¸Šä¸€èŠ‚æ•²å‡ºæ¨¡æ¿

å®Œå–„ä¸‹è½½å•ä¸ªé¡µé¢çš„ä»£ç 

å®Œæ•´ä»£ç  

è¿è¡Œæ•ˆæœ

æ€»ç»“

* * *

### å‰è¨€

åœ¨[ä¸Šä¸€èŠ‚](https://blog.csdn.net/m0_59180666/article/details/128626343 "ä¸Šä¸€èŠ‚")ä¸­ï¼Œæˆ‘ä»¬å‘ç°time.sleep()ä¸æ˜¯å¼‚æ­¥çš„ï¼Œå¯¼è‡´æˆ‘ä»¬çš„å¼‚æ­¥å‡½æ•°æ— æ³•æŒ‰å¼‚æ­¥æ‰§è¡Œã€‚å®é™…ä¸Šï¼Œrequestsæ¨¡å—çš„ç½‘ç»œè¯·æ±‚å‡½æ•°ï¼Œget()ã€post()ç­‰ä¹Ÿéƒ½ä¸æ˜¯å¼‚æ­¥çš„ã€‚æ‰€ä»¥æˆ‘ä»¬æƒ³ç”¨å®ƒä»¬åšå¼‚æ­¥çˆ¬è™«ä¸ç½‘ç»œè¯·æ±‚æ—¶ï¼Œå°±å¿…é¡»ä½¿ç”¨å¼‚æ­¥çš„HTTPè¯·æ±‚ï¼Œä»è€Œè®©å¼‚æ­¥å‡½æ•°æ­£å¸¸å·¥ä½œã€‚

é‚£ä¹ˆåœ¨Pythonä¸­å¦‚ä½•å®ç°å¼‚æ­¥HTTPè¯·æ±‚å‘¢ï¼Ÿè¿™å°±éœ€è¦ç”¨åˆ°æˆ‘ä»¬æœ¬èŠ‚è¦ä»‹ç»çš„æ–°æ¨¡å—â€”â€”aiohttp

* * *

### aiohttpç®€ä»‹

**`asyncio`** å¯ä»¥å®ç°å•çº¿ç¨‹å¹¶å‘IOæ“ä½œã€‚å¦‚æœä»…ç”¨åœ¨å®¢æˆ·ç«¯ï¼Œå‘æŒ¥çš„å¨åŠ›ä¸å¤§ã€‚å¦‚æœæŠŠ**`asyncio`** ç”¨åœ¨æœåŠ¡å™¨ç«¯ï¼Œä¾‹å¦‚WebæœåŠ¡å™¨ï¼Œç”±äºHTTPè¿æ¥å°±æ˜¯IOæ“ä½œï¼Œå› æ­¤å¯ä»¥ç”¨å•çº¿ç¨‹+**`coroutineï¼ˆåç¨‹ï¼‰`** å®ç°å¤šç”¨æˆ·çš„é«˜å¹¶å‘æ”¯æŒã€‚

**`asyncio`** å®ç°äº†TCPã€UDPã€SSLç­‰åè®®ï¼Œ**`aiohttp`** åˆ™æ˜¯åŸºäº**`asyncio`** å®ç°çš„HTTPæ¡†æ¶ã€‚

* * *

### aiohttpå®‰è£…

```python pip install aiohttp ``` 

* * *

### aiohttpåº”ç”¨

æˆ‘ä»¬è¿˜æ˜¯ç”¨ä¸€ä¸ªä¾‹å­æ¥è¯´æ˜å¼‚æ­¥HTTPçš„ä½¿ç”¨æ–¹æ³•å§ã€‚

åŠ å…¥æˆ‘ä»¬æœ‰ä¸€ç»„å›¾ç‰‡æƒ³è¦æŠ“å–ï¼Œå·²ç»è·å¾—äº†è¿™ä¸€å †å›¾ç‰‡çš„URLã€‚

#### å…ˆå¯¼åŒ…

```python import asyncio import aiohttp ``` 

è¦ç”¨åˆ°å¼‚æ­¥HTTPè¯·æ±‚å¿…ç„¶å°‘ä¸äº†å¼‚æ­¥I/Oï¼Œå› ä¸ºç½‘ç»œè¯·æ±‚æœ¬èº«å°±æ˜¯ä¸€ç§I/Oè¿‡ç¨‹ã€‚

#### æ‹¿åˆ°äº†æ‰¹é‡URL

```python urls = [ "http://kr.shanghai-jiuxin.com/file/2021/0809/e9c2d265db15c768bd1fca0cb32cfc05.jpg", "http://kr.shanghai-jiuxin.com/file/2021/0809/f248df8386379735d855d1e56e9baae9.jpg", "http://kr.shanghai-jiuxin.com/file/2021/0809/ea079076530e5f3e85f1f1090428b6f9.jpg" ] ``` 

#### ä»¿ç…§[ä¸Šä¸€èŠ‚](https://blog.csdn.net/m0_59180666/article/details/128626343 "ä¸Šä¸€èŠ‚")æ•²å‡ºæ¨¡æ¿

```python async def aiodownload(url): # TODO # å®Œæˆå•ä¸ªé¡µé¢ä¸‹è½½ä»»åŠ¡ async def main(): # å‡†å¤‡å¼‚æ­¥åç¨‹å¯¹è±¡åˆ—è¡¨ tasks = [] for url in urls: d = asyncio.create_task(download(url)) tasks.append(d) # ä¸€æ¬¡æ€§æŠŠæ‰€æœ‰ä»»åŠ¡éƒ½æ‰§è¡Œ await asyncio.wait(tasks) if __name__ == '__main__': asyncio.run(main()) ``` 

#### å®Œå–„ä¸‹è½½å•ä¸ªé¡µé¢çš„ä»£ç 

```python async def aiodownload(url): # å‘é€è¯·æ±‚ # å¾—åˆ°å›¾ç‰‡å†…å®¹ # ä¿å­˜åˆ°æ–‡ä»¶ name = url.rsplit("/", 1)[1] # ä»å³è¾¹åˆ‡, åˆ‡ä¸€æ¬¡. å¾—åˆ°[1]ä½ç½®çš„å†…å®¹ async with aiohttp.ClientSession() as session: # requests async with session.get(url) as resp: # resp = requests.get() # è¯·æ±‚å›æ¥äº†. å†™å…¥æ–‡ä»¶ # å¯ä»¥è‡ªå·±å»å­¦ä¹ ä¸€ä¸ªæ¨¡å—, aiofiles with open(f"./aiohttp_img/{name}", mode="wb") as f: # åˆ›å»ºæ–‡ä»¶ f.write(await resp.content.read()) # è¯»å–å†…å®¹æ˜¯å¼‚æ­¥çš„. éœ€è¦awaitæŒ‚èµ·, resp.text() print(name, "Complete!") ``` 

  * å…ˆå°†URLæœ€åçš„é‚£ä¸€æ®µä½œä¸ºå›¾ç‰‡åç§°ï¼Œé€šè¿‡åˆ‡ç‰‡å¾—åˆ°ã€‚
  * å†åˆ›å»ºä¸€ä¸ªå¼‚æ­¥ç”¨æˆ·å¯¹è¯ï¼Œå®ƒçš„ç”¨æ³•ç›¸å½“äºrequestsæ¨¡å—ã€‚
  * å¼‚æ­¥è¯·æ±‚æ•°æ®ï¼Œå¹¶å†™å…¥æ–‡ä»¶ï¼Œæ³¨æ„ä¹Ÿè¦å¼‚æ­¥è¯»å–ï¼Œç”¨awaitæŒ‚èµ·ï¼Œå¦åˆ™å¼‚æ­¥å¤±æ•ˆã€‚ï¼ˆä¹Ÿå¯ä»¥å­¦ä¹ aiofilesæ¥å¼‚æ­¥å†™å…¥æ–‡ä»¶çš„æ–¹å¼ï¼‰

* * *

### å®Œæ•´ä»£ç  

```python # requests.get() åŒæ­¥çš„ä»£ç  -> å¼‚æ­¥æ“ä½œaiohttp # pip install aiohttp import asyncio import aiohttp urls = [ "http://kr.shanghai-jiuxin.com/file/2021/0809/e9c2d265db15c768bd1fca0cb32cfc05.jpg", "http://kr.shanghai-jiuxin.com/file/2021/0809/f248df8386379735d855d1e56e9baae9.jpg", "http://kr.shanghai-jiuxin.com/file/2021/0809/ea079076530e5f3e85f1f1090428b6f9.jpg" ] async def aiodownload(url): # å‘é€è¯·æ±‚ # å¾—åˆ°å›¾ç‰‡å†…å®¹ # ä¿å­˜åˆ°æ–‡ä»¶ name = url.rsplit("/", 1)[1] # ä»å³è¾¹åˆ‡, åˆ‡ä¸€æ¬¡. å¾—åˆ°[1]ä½ç½®çš„å†…å®¹ async with aiohttp.ClientSession() as session: # requests async with session.get(url) as resp: # resp = requests.get() # è¯·æ±‚å›æ¥äº†. å†™å…¥æ–‡ä»¶ # å¯ä»¥è‡ªå·±å»å­¦ä¹ ä¸€ä¸ªæ¨¡å—, aiofiles with open(f"./aiohttp_img/{name}", mode="wb") as f: # åˆ›å»ºæ–‡ä»¶ f.write(await resp.content.read()) # è¯»å–å†…å®¹æ˜¯å¼‚æ­¥çš„. éœ€è¦awaitæŒ‚èµ·, resp.text() print(name, "Complete!") async def main(): tasks = [] for url in urls: tasks.append(aiodownload(url)) await asyncio.wait(tasks) if __name__ == '__main__': asyncio.run(main()) ``` 

* * *

### è¿è¡Œæ•ˆæœ

![](/images/posts/23.-å¼‚æ­¥HTTPè¯·æ±‚ä¸aiohttpæ¨¡å—/c16b2ea9d2e3.png)

![](/images/posts/23.-å¼‚æ­¥HTTPè¯·æ±‚ä¸aiohttpæ¨¡å—/db2f9fbdfdce.png)

* * *

### æ€»ç»“

æœ¬èŠ‚æˆ‘ä»¬ä»‹ç»äº†å¼‚æ­¥HTTPè¯·æ±‚çš„æ–¹æ³•â€”â€”å€ŸåŠ©aiohttpåº“å®ç°ã€‚é€šè¿‡ä¸€ä¸ªç®€å•çš„å®ä¾‹å®è·µäº†å¼‚æ­¥HTTPè¯·æ±‚ï¼Œæ•ˆç‡ä¹Ÿæ˜¯æé«˜çš„ï¼Œä¸åˆ°ä¸€çœ¨çœ¼çš„åŠŸå¤«ï¼Œä¸‰æ¡URLçš„å†…å®¹å·²ç»å…¨éƒ¨ä¿å­˜åˆ°æœ¬åœ°äº†ã€‚
