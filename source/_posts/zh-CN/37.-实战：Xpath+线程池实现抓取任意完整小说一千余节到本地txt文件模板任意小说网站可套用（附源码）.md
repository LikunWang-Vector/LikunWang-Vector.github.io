---
title: "37. å®æˆ˜ï¼šXpath+çº¿ç¨‹æ± å®ç°æŠ“å–ä»»æ„å®Œæ•´å°è¯´ä¸€åƒä½™èŠ‚åˆ°æœ¬åœ°txtæ–‡ä»¶/æ¨¡æ¿ä»»æ„å°è¯´ç½‘ç«™å¯å¥—ç”¨ï¼ˆé™„æºç ï¼‰"
date: 2023-02-02
updated: 2023-02-02
categories:
  - Pythonçˆ¬è™«å…¥é—¨ã€è¿›é˜¶ä¸å®æˆ˜
tags:
  - å¼€å‘è¯­è¨€
  - python
  - æ•°æ®åˆ†æ
  - çº¿ç¨‹æ± 
  - XPath
csdn_views: 2274
csdn_likes: 6
csdn_comments: 8
csdn_favorites: 17
csdn_url: https://blog.csdn.net/m0_59180666/article/details/128847526
cover: /images/posts/37.-å®æˆ˜ï¼šXpath+çº¿ç¨‹æ± å®ç°æŠ“å–ä»»æ„å®Œæ•´å°è¯´ä¸€åƒä½™èŠ‚/6ee61c1d85b8.png
lang_pair:
  en: "37. Practical: XPath + Thread Pool Novel Scraper"
---

> æœ¬æ–‡è¿ç§»è‡ªCSDNåšå®¢
> åŸæ–‡é“¾æ¥ï¼š[37. å®æˆ˜ï¼šXpath+çº¿ç¨‹æ± å®ç°æŠ“å–ä»»æ„å®Œæ•´å°è¯´ä¸€åƒä½™èŠ‚åˆ°æœ¬åœ°txtæ–‡ä»¶/æ¨¡æ¿ä»»æ„å°è¯´ç½‘ç«™å¯å¥—ç”¨ï¼ˆé™„æºç ï¼‰](https://blog.csdn.net/m0_59180666/article/details/128847526)
> ğŸ“Š 2274 é˜…è¯» | ğŸ‘ 6 ç‚¹èµ | ğŸ’¬ 8 è¯„è®º | â­ 17 æ”¶è—

**ç›®å½•**

å‰è¨€

ç›®çš„

æ€è·¯

ä»£ç å®ç°

1\. ä»ç»™å®šçš„URLä¸­æ‹¿åˆ°æ‰€æœ‰ç« èŠ‚çš„æ ‡é¢˜å’Œå­é“¾æ¥

2\. å°†æ ‡é¢˜å’Œå­é“¾æ¥å½¢æˆä¸€ä¸ªå­—å…¸ï¼Œä¾¿äºåç»­æå–ä¿¡æ¯

3\. å®ç°åœ¨å•ä¸ªç« èŠ‚è¯¦ç»†é¡µé¢æå–æ‰€æœ‰æ–‡æœ¬ä¿¡æ¯

4\. ä¿å­˜åˆ°æœ¬åœ°æ–‡ä»¶ï¼Œåœ¨å‰é¢åŠ ä¸Šæ•°å­—åºå·ä¾¿äºé¡ºåºä¿å­˜

5\. åœ¨ä¸»å‡½æ•°ä¸­æ·»åŠ çº¿ç¨‹æ± ï¼Œéå†å­—å…¸è¾“å…¥æ ‡é¢˜å’Œå­é“¾æ¥å¼€å§‹å¤šçº¿ç¨‹ä»»åŠ¡

å®Œæ•´æºç 

è¿è¡Œæ•ˆæœ

æ€»ç»“

* * *

### å‰è¨€

æœ¬æ¥æ˜¯æƒ³å®ç°æŠ“å–ç•ªèŒ„å°è¯´çš„ï¼Œä½†æ˜¯å®ƒè™½ç„¶å…è´¹ï¼Œå½“æˆ‘å†™å®Œå…¨éƒ¨ä»£ç çš„æ—¶å€™æ‰å‘ç°åé¢çš„éƒ¨åˆ†åªèƒ½ä¸‹è½½APPçœ‹ï¼ŒçœŸæ˜¯å‘äºº......è¿˜å¥½æˆ‘æŠŠå‡½æ•°éƒ½å°è£…äº†ï¼Œæ•´ä½“é€»è¾‘æ˜¯ä¸å˜çš„ï¼Œæœ€ç»ˆé€‰æ‹©äº†å¦ä¸€ä¸ªå…è´¹å°è¯´ç½‘â€”â€”ç¬”è¶£é˜ä½œä¸ºæ¡ˆä¾‹ã€‚

è€è§„çŸ©ï¼Œæˆ‘è¿˜æ˜¯æŠŠ**é“¾æ¥æ”¾åœ¨è¯„è®ºåŒº** ï¼Œä¸ç„¶å®¡æ ¸ä¸è¿‡çš„

åŒæ—¶æˆ‘ä¹Ÿä¼šæŠŠç•ªèŒ„å°è¯´çš„æ”¾åˆ°æœ€åçš„å®Œæ•´ä»£ç éƒ¨åˆ†ä¾›å¤§å®¶å€Ÿé‰´ã€‚

* * *

### ç›®çš„

ç»™å®šå°è¯´URLï¼Œä½¿ç”¨Xpath+çº¿ç¨‹æ± å®ç°æŠ“å–ä»»æ„å®Œæ•´å°è¯´ï¼Œå¹¶åˆ†ç« èŠ‚æŒ‰é¡ºåºä¿å­˜åˆ°æœ¬åœ°txtæ–‡ä»¶ã€‚

* * *

### æ€è·¯

æ€è·¯å…¶å®å¾ˆæ¸…æ™°ï¼š

1\. ä»ç»™å®šçš„URLä¸­æ‹¿åˆ°æ‰€æœ‰ç« èŠ‚çš„æ ‡é¢˜å’Œå­é“¾æ¥

2\. å°†æ ‡é¢˜å’Œå­é“¾æ¥å½¢æˆä¸€ä¸ªå­—å…¸ï¼Œä¾¿äºåç»­æå–ä¿¡æ¯

3\. å®ç°åœ¨å•ä¸ªç« èŠ‚è¯¦ç»†é¡µé¢æå–æ‰€æœ‰æ–‡æœ¬ä¿¡æ¯

4\. ä¿å­˜åˆ°æœ¬åœ°æ–‡ä»¶ï¼Œåœ¨å‰é¢åŠ ä¸Šæ•°å­—åºå·ä¾¿äºé¡ºåºä¿å­˜

5\. åœ¨ä¸»å‡½æ•°ä¸­æ·»åŠ çº¿ç¨‹æ± ï¼Œéå†å­—å…¸è¾“å…¥æ ‡é¢˜å’Œå­é“¾æ¥å¼€å§‹å¤šçº¿ç¨‹ä»»åŠ¡

* * *

### ä»£ç å®ç°

è¯¦ç»†çš„è¿‡ç¨‹æˆ‘å°±ä¸åœ¨è¿™é‡Œèµ˜è¿°äº†ï¼Œä¹‹å‰è®²è¿‡ç±»ä¼¼çš„æ¡ˆä¾‹ï¼š[ç”¨å¼‚æ­¥æ³•è·å–å®Œæ•´çš„ä¸€éƒ¨å°è¯´](https://blog.csdn.net/m0_59180666/article/details/128649022 "ç”¨å¼‚æ­¥æ³•è·å–å®Œæ•´çš„ä¸€éƒ¨å°è¯´")

XPathä¹Ÿè®²è¿‡çš„ï¼š[XPathè§£æå…¥é—¨](https://blog.csdn.net/m0_59180666/article/details/128519694 "XPathè§£æå…¥é—¨") [å®æˆ˜ï¼šXPathæ³•æŠ“å–æŸç½‘ç«™å¤–åŒ…ä¿¡æ¯](https://blog.csdn.net/m0_59180666/article/details/128527232 "å®æˆ˜ï¼šXPathæ³•æŠ“å–æŸç½‘ç«™å¤–åŒ…ä¿¡æ¯")

å°ç™½å¯ä»¥å…ˆçœ‹ä¸Šé¢å‡ ç¯‡å†çœ‹ä¸‹é¢çš„ä»£ç ä¼šå¥½æ‡‚ä¸€äº›ã€‚

#### 1\. ä»ç»™å®šçš„URLä¸­æ‹¿åˆ°æ‰€æœ‰ç« èŠ‚çš„æ ‡é¢˜å’Œå­é“¾æ¥

```python def get_chapter(): chap_cnt = 1 chapter_dic = {} for i in range(1, 100): new_url = novel_url + f'index_{i}.html' resp = requests.get(new_url, headers=headers) resp.encoding = 'gbk' resp_parser = etree.HTML(resp.text) if not resp_parser.xpath('/html/body/div[4]/dl/dd'): break chaps = resp_parser.xpath('/html/body/div[4]/dl/dd') for chap in chaps: if not chap.xpath("./a/@href"): break url = novel_url + chap.xpath("./a/@href")[0] title = f'{chap_cnt}_' + chap.xpath("./a/text()")[0] print(title) ``` 

#### 2\. å°†æ ‡é¢˜å’Œå­é“¾æ¥å½¢æˆä¸€ä¸ªå­—å…¸ï¼Œä¾¿äºåç»­æå–ä¿¡æ¯

```python chapter_dic[title] = url chap_cnt += 1 return chapter_dic ``` 

#### 3\. å®ç°åœ¨å•ä¸ªç« èŠ‚è¯¦ç»†é¡µé¢æå–æ‰€æœ‰æ–‡æœ¬ä¿¡æ¯

```python def get_novel(title, url): resp = requests.get(url, headers=headers) resp.encoding = 'gbk' novel = etree.HTML(resp.text) title = title content = novel.xpath('//*[@id="content"]//text()') ``` 

#### 4\. ä¿å­˜åˆ°æœ¬åœ°æ–‡ä»¶ï¼Œåœ¨å‰é¢åŠ ä¸Šæ•°å­—åºå·ä¾¿äºé¡ºåºä¿å­˜

```python if not os.path.exists('./7_Free_Novel_Folder'): os.mkdir('./7_Free_Novel_Folder') with open(f'./7_Free_Novel_Folder/{title}.txt', mode='a', encoding='gbk') as f: for cont in content: cont = cont.replace('\xa0', ' ') f.write(cont + '\n') print(title + '\tä¸‹è½½å®Œæˆ!') ``` 

#### 5\. åœ¨ä¸»å‡½æ•°ä¸­æ·»åŠ çº¿ç¨‹æ± ï¼Œéå†å­—å…¸è¾“å…¥æ ‡é¢˜å’Œå­é“¾æ¥å¼€å§‹å¤šçº¿ç¨‹ä»»åŠ¡

```python def main(): chapter_dic = get_chapter() # åˆ›å»ºçº¿ç¨‹æ±  with ThreadPoolExecutor(50) as t: for chapter in chapter_dic: t.submit(get_novel, title=chapter, url=chapter_dic[chapter]) # ç­‰å¾…çº¿ç¨‹æ± ä¸­çš„ä»»åŠ¡å…¨éƒ¨æ‰§è¡Œå®Œæ¯• # get_novel('1', 'https://www.bbiquge.net/book/132573/55226877.html') print("Clear!!!") if __name__ == '__main__': main() ``` 

* * *

### å®Œæ•´æºç 

```python import requests from lxml import etree from concurrent.futures import ThreadPoolExecutor import os novel_url = 'è§è¯„è®ºåŒº' headers = { 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/109.0.0.0 Safari/537.36 Edg/109.0.1518.61' } def get_chapter(): chap_cnt = 1 chapter_dic = {} for i in range(1, 100): new_url = novel_url + f'index_{i}.html' resp = requests.get(new_url, headers=headers) resp.encoding = 'gbk' resp_parser = etree.HTML(resp.text) if not resp_parser.xpath('/html/body/div[4]/dl/dd'): break chaps = resp_parser.xpath('/html/body/div[4]/dl/dd') for chap in chaps: if not chap.xpath("./a/@href"): break url = novel_url + chap.xpath("./a/@href")[0] title = f'{chap_cnt}_' + chap.xpath("./a/text()")[0] print(title) chapter_dic[title] = url chap_cnt += 1 return chapter_dic def get_novel(title, url): resp = requests.get(url, headers=headers) resp.encoding = 'gbk' novel = etree.HTML(resp.text) title = title content = novel.xpath('//*[@id="content"]//text()') if not os.path.exists('./7_Free_Novel_Folder'): os.mkdir('./7_Free_Novel_Folder') with open(f'./7_Free_Novel_Folder/{title}.txt', mode='a', encoding='gbk') as f: for cont in content: cont = cont.replace('\xa0', ' ') f.write(cont + '\n') print(title + '\tä¸‹è½½å®Œæˆ!') def main(): chapter_dic = get_chapter() # åˆ›å»ºçº¿ç¨‹æ±  with ThreadPoolExecutor(50) as t: for chapter in chapter_dic: t.submit(get_novel, title=chapter, url=chapter_dic[chapter]) # ç­‰å¾…çº¿ç¨‹æ± ä¸­çš„ä»»åŠ¡å…¨éƒ¨æ‰§è¡Œå®Œæ¯• # get_novel('1', 'https://www.bbiquge.net/book/132573/55226877.html') print("Clear!!!") if __name__ == '__main__': main() ``` 

ä¸‹é¢æˆ‘æŠŠ**ç•ªèŒ„å°è¯´** çš„ä¹Ÿæ”¾ä¸Šæ¥ï¼Œæ•´ä½“é€»è¾‘çœŸçš„æ˜¯ä¸€æ¨¡ä¸€æ ·ï¼Œæ‰€ä»¥åŒæ ·ä¹Ÿé€‚ç”¨å…¶ä»–çš„å°è¯´ç½‘ï¼Œéƒ½å¤§åŒå°å¼‚ï¼š

```python import requests from lxml import etree from concurrent.futures import ThreadPoolExecutor import os domain = 'è§è¯„è®ºåŒº' novel_url = 'è§è¯„è®ºåŒº' headers = { 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/109.0.0.0 Safari/537.36 Edg/109.0.1518.61' } def get_chapter(): resp = requests.get(novel_url, headers=headers) resp_parser = etree.HTML(resp.text) modules = resp_parser.xpath('//div[@class="page-body"]/div[4]/div') chapter_dic = {} chap_cnt = 1 for module in modules: chapters = module.xpath("./div[@class='chapter']/div") for chapter in chapters: url = domain + chapter.xpath("./a/@href")[0] title = f'{chap_cnt}_' + chapter.xpath("./a/text()")[0] chapter_dic[title] = url chap_cnt += 1 return chapter_dic def get_novel(title, url): resp = requests.get(url, headers=headers) novel = etree.HTML(resp.text) title = title content = novel.xpath('//div[@class="muye-reader-content noselect"]//text()') if not os.path.exists('./7_Tomato_Novel_Folder'): os.mkdir('./7_Tomato_Novel_Folder') with open(f'./7_Tomato_Novel_Folder/{title}.txt', mode='a') as f: for cont in content: f.write(cont + '\n') print(title + '\tä¸‹è½½å®Œæˆ!') def main(): chapter_dic = get_chapter() # åˆ›å»ºçº¿ç¨‹æ±  with ThreadPoolExecutor(50) as t: for chapter in chapter_dic: t.submit(get_novel, title=chapter, url=chapter_dic[chapter]) # ç­‰å¾…çº¿ç¨‹æ± ä¸­çš„ä»»åŠ¡å…¨éƒ¨æ‰§è¡Œå®Œæ¯• print("Clear!!!") if __name__ == '__main__': main() ``` 

* * *

### è¿è¡Œæ•ˆæœ

![](/images/posts/37.-å®æˆ˜ï¼šXpath+çº¿ç¨‹æ± å®ç°æŠ“å–ä»»æ„å®Œæ•´å°è¯´ä¸€åƒä½™èŠ‚/6ee61c1d85b8.png)

![](/images/posts/37.-å®æˆ˜ï¼šXpath+çº¿ç¨‹æ± å®ç°æŠ“å–ä»»æ„å®Œæ•´å°è¯´ä¸€åƒä½™èŠ‚/bf5c4295a52b.png)

* * *

### æ€»ç»“

æœ¬èŠ‚å®ç°äº†ç»™å®šå°è¯´URLï¼Œä½¿ç”¨Xpath+çº¿ç¨‹æ± å®ç°æŠ“å–ä»»æ„å®Œæ•´å°è¯´ï¼Œå¹¶åˆ†ç« èŠ‚æŒ‰é¡ºåºä¿å­˜åˆ°æœ¬åœ°txtæ–‡ä»¶çš„ä»»åŠ¡ã€‚

å¦‚æœæƒ³æŠŠæ‰€æœ‰å°è¯´æ”¾åœ¨åŒä¸€ä¸ªtxtæ–‡ä»¶ä¸­åªéœ€è¦ç•¥å¾®ä¿®æ”¹ï¼ŒæŠŠæ‰€æœ‰æ–‡æœ¬å†™åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­éå†å°±å¥½ï¼Œç›¸ä¿¡çœ‹è¿™ç¯‡æ–‡ç« çš„å°ä¼™ä¼´æœ‰è¿™ä¸ªèƒ½åŠ›ã€‚å¦‚æœæƒ³å®ç°è¿™ä¸ªåŠŸèƒ½ä½†æ˜¯ä¸ä¼šçš„ä¹Ÿå¯ä»¥ç§ä¿¡æˆ‘ï¼Œæˆ‘å¸®ä½ å†™ä¸€ä»½ã€‚
