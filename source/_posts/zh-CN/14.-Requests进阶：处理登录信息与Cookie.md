---
title: "14. Requestsè¿›é˜¶ï¼šå¤„ç†ç™»å½•ä¿¡æ¯ä¸Cookie"
date: 2023-01-03
updated: 2023-01-03
categories:
  - Pythonçˆ¬è™«å…¥é—¨ã€è¿›é˜¶ä¸å®æˆ˜
tags:
  - çˆ¬è™«
  - python
  - ç½‘ç»œçˆ¬è™«
  - æ•°æ®åˆ†æ
csdn_views: 964
csdn_likes: 3
csdn_comments: 1
csdn_favorites: 6
csdn_url: https://blog.csdn.net/m0_59180666/article/details/128530525
cover: /images/posts/14.-Requestsè¿›é˜¶ï¼šå¤„ç†ç™»å½•ä¿¡æ¯ä¸Cookie/2b7d39717143.png
lang_pair:
  en: "14. Requests Advanced: Handling Login and Cookies"
---

> æœ¬æ–‡è¿ç§»è‡ªCSDNåšå®¢
> åŸæ–‡é“¾æ¥ï¼š[14. Requestsè¿›é˜¶ï¼šå¤„ç†ç™»å½•ä¿¡æ¯ä¸Cookie](https://blog.csdn.net/m0_59180666/article/details/128530525)
> ğŸ“Š 964 é˜…è¯» | ğŸ‘ 3 ç‚¹èµ | ğŸ’¬ 1 è¯„è®º | â­ 6 æ”¶è—

**ç›®å½•**

å‰è¨€

ç›®çš„

æ€è·¯

ä»£ç å®ç°

1\. sessionæ³•

2\. requestsæ³•

å®Œæ•´ä»£ç 

sessionæ³•

requestsæ³•

æ€»ç»“

* * *

### å‰è¨€

æˆ‘ä»¬åœ¨å‰é¢çš„çˆ¬è™«å­¦ä¹ è¿‡ç¨‹ä¸­å·²ç»ç”¨è¿‡headersäº†ï¼Œå¯¹å®ƒå¹¶ä¸é™Œç”Ÿã€‚Headerä¸ºHTTPåè®®ä¸­çš„è¯·æ±‚å¤´ï¼Œâ¼€èˆ¬å­˜æ”¾â¼€äº›å’Œè¯·æ±‚å†…å®¹æ— å…³çš„æ•°æ®ï¼Œæœ‰æ—¶ä¹Ÿä¼šå­˜æ”¾â¼€äº›å®‰å…¨éªŒè¯ä¿¡æ¯ã€‚æ¯”å¦‚å¸¸è§çš„User-Agent, token, cookieç­‰ã€‚

é€šè¿‡requestså‘é€çš„è¯·æ±‚ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡headersä¿å­˜è¯·æ±‚å¤´ä¿¡æ¯æ¥å¤„ç†cookieç­‰ï¼Œä¹Ÿå¯ä»¥å•ç‹¬è¿›è¡Œå­˜æ”¾ï¼Œæœ€åç”±requestsæ¥å¸®æˆ‘ä»¬è‡ªåŠ¨æ‹¼æ¥æˆå®Œæ•´çš„httpè¯·æ±‚ã€‚

æœ¬ç« æˆ‘ä»¬å°†å¼•å…¥ä¸€ä¸ªæ–°çš„æ¦‚å¿µï¼šä¼šè¯ï¼ˆsessionï¼‰ã€‚å®ƒä¼šè®°ä½ä»¥å‰è¯·æ±‚åˆ°çš„ä¿¡æ¯ï¼Œå¹¶æ²¿ç”¨åˆ°åé¢çš„urlè¯·æ±‚ï¼Œç±»ä¼¼æµè§ˆå™¨çš„ç¼“å­˜æœºåˆ¶ã€‚è€Œrequestæ¯æ¬¡éƒ½é»˜è®¤æ˜¯ç¬¬ä¸€æ¬¡è®¿é—®ï¼Œä¸ä¼šè®°ä½è®¿é—®çš„ç¼“å­˜ã€‚

* * *

### ç›®çš„

æˆ‘ä»¬ä»¥æŸå°è¯´ç½‘ä¸ºä¾‹ï¼ŒæŠ“å–ç”¨æˆ·é˜…è¯»è¿‡çš„å°è¯´åˆ—è¡¨ï¼Œç”¨requestså’Œsessionä¸¤ç§æ–¹æ³•æ¥æ“ä½œã€‚

* * *

### æ€è·¯

1\. ç™»å½•â€”â€”å¾—åˆ°cookie

2\. å¸¦ç€cookieè¯·æ±‚ä¹¦æ¶urlâ€”â€”è·å–ä¹¦æ¶å†…å®¹

* * *

### ä»£ç å®ç°

#### 1\. sessionæ³•

é¦–å…ˆå¯¼åŒ…ï¼Œè°ƒç”¨sessionæ¥å£ï¼Œè¾“å…¥ç”¨æˆ·åå¯†ç å­—å…¸ä¿¡æ¯ï¼ˆè¿™é‡Œè‡ªå·±å»æ³¨å†Œä¸€ä¸‹è¾“å…¥å°±å¥½ï¼‰

```python import requests # ä¼šè¯ session = requests.session() data = { "loginName": "TODO", "password": "TODO" } ``` 

æ£€æŸ¥ç½‘ç»œï¼Œè·å–ç™»å½•urlï¼Œä½¿ç”¨sessionè¯·æ±‚ï¼Œæ³¨æ„è¯·æ±‚æ–¹å¼ä¸ºpost

```python # 1. ç™»å½• url = "https://passport.17k.com/ck/user/login" session.post(url, data=data) # print(resp.text) # print(resp.cookies) # çœ‹cookie ``` 

æ£€æŸ¥ç½‘ç»œï¼Œè·å–ä¹¦æ¶urlï¼Œç»§ç»­ä½¿ç”¨sessionè¯·æ±‚ï¼Œæ³¨æ„è¯·æ±‚æ–¹å¼ä¸ºget

```python # 2. æ‹¿ä¹¦æ¶ä¸Šçš„æ•°æ® # åˆšæ‰çš„é‚£ä¸ªsessionä¸­æ˜¯æœ‰cookieçš„ resp = session.get('https://user.17k.com/ck/author/shelf?page=1&appKey=2406394919') print(resp.json()) ``` 

#### 2\. requestsæ³•

ç™»é™†åæ£€æŸ¥æµè§ˆå™¨Headerä¿¡æ¯æ‹¿åˆ°cookieï¼Œåœ¨requestsè¯·æ±‚ä¸­ç›´æ¥å†™å…¥headersä¸­ï¼š

![](/images/posts/14.-Requestsè¿›é˜¶ï¼šå¤„ç†ç™»å½•ä¿¡æ¯ä¸Cookie/2b7d39717143.png)

æ‹¿åˆ°ä¹¦æ¶ä¿¡æ¯çš„è¯·æ±‚URLï¼Œå¹¶æ‹¿åˆ°cookie

```python cookie = 'TODO' resp = requests.get("https://user.17k.com/ck/author/shelf?page=1&appKey=2406394919", headers={"Cookie": cookie}) print(resp.text) ``` 

cookieç”¨è‡ªå·±çš„ï¼Œæ¯ä¸ªäººçš„ä¸åŒã€‚è¿è¡Œä¹Ÿå¯ä»¥çœ‹åˆ°æˆåŠŸå¾—åˆ°ç»“æœã€‚è¿™é‡Œè¦æ³¨æ„å¦‚æœcookieé‡Œé¢æ˜¯åŒå¼•å·å°±ä¸èƒ½ç”¨åŒå¼•å·åŒ…è£¹ï¼Œè¦æ¢æˆå•å¼•å·ã€‚

* * *

### å®Œæ•´ä»£ç 

#### sessionæ³•

```python # ç™»å½• -> å¾—åˆ°cookie # å¸¦ç€cookie å»è¯·æ±‚åˆ°ä¹¦æ¶url -> ä¹¦æ¶ä¸Šçš„å†…å®¹ # å¿…é¡»å¾—æŠŠä¸Šé¢çš„ä¸¤ä¸ªæ“ä½œè¿èµ·æ¥ # æˆ‘ä»¬å¯ä»¥ä½¿ç”¨sessionè¿›è¡Œè¯·æ±‚ -> sessionä½ å¯ä»¥è®¤ä¸ºæ˜¯ä¸€è¿ä¸²çš„è¯·æ±‚. åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­çš„cookieä¸ä¼šä¸¢å¤± import requests # ä¼šè¯ session = requests.session() data = { "loginName": "TODO", "password": "TODO" } # 1. ç™»å½• url = "https://passport.17k.com/ck/user/login" session.post(url, data=data) # print(resp.text) # print(resp.cookies) # çœ‹cookie # 2. æ‹¿ä¹¦æ¶ä¸Šçš„æ•°æ® # åˆšæ‰çš„é‚£ä¸ªsessionä¸­æ˜¯æœ‰cookieçš„ resp = session.get('https://user.17k.com/ck/author/shelf?page=1&appKey=2406394919') print(resp.json()) ``` 

#### requestsæ³•

```python import requests cookie = 'TODO' resp = requests.get("https://user.17k.com/ck/author/shelf?page=1&appKey=2406394919", headers={"Cookie": cookie}) print(resp.text) ``` 

* * *

### æ€»ç»“

ä»Šå¤©æˆ‘ä»¬å¯¹requestsç”¨æ³•æœ‰äº†è¿›é˜¶ï¼Œè®¤è¯†äº†cookieç­‰å®‰å…¨éªŒè¯ä¿¡æ¯ï¼Œç»ƒä¹ äº†sessionçš„ç”¨æ³•ï¼Œæ˜ç™½äº†ä¼šè¯çš„æ¦‚å¿µï¼Œå¹¶ç”¨æŸå°è¯´ç½‘è¿›è¡Œå®ä¾‹éªŒè¯ã€‚ä¸‹ä¸€èŠ‚æˆ‘ä»¬å°†çˆ¬å–æŸè§†é¢‘ç½‘çš„è§†é¢‘èµ„æºã€‚
