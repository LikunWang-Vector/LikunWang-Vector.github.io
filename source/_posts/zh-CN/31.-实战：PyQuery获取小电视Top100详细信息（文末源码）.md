---
title: "31. å®æˆ˜ï¼šPyQueryè·å–å°ç”µè§†Top100è¯¦ç»†ä¿¡æ¯ï¼ˆæ–‡æœ«æºç ï¼‰"
date: 2023-01-26
updated: 2023-01-26
categories:
  - Pythonçˆ¬è™«å…¥é—¨ã€è¿›é˜¶ä¸å®æˆ˜
tags:
  - python
  - å¼€å‘è¯­è¨€
  - pyquery
  - æ•°æ®åˆ†æ
csdn_views: 784
csdn_likes: 1
csdn_comments: 2
csdn_favorites: 1
csdn_url: https://blog.csdn.net/m0_59180666/article/details/128764511
cover: /images/posts/31.-å®æˆ˜ï¼šPyQueryè·å–å°ç”µè§†Top100è¯¦ç»†ä¿¡æ¯ï¼ˆ/d2dca9723bc6.png
lang_pair:
  en: "31. Practical: PyQuery Scraping Video Site Top 100 Rankings"
---

> æœ¬æ–‡è¿ç§»è‡ªCSDNåšå®¢
> åŸæ–‡é“¾æ¥ï¼š[31. å®æˆ˜ï¼šPyQueryè·å–å°ç”µè§†Top100è¯¦ç»†ä¿¡æ¯ï¼ˆæ–‡æœ«æºç ï¼‰](https://blog.csdn.net/m0_59180666/article/details/128764511)
> ğŸ“Š 784 é˜…è¯» | ğŸ‘ 1 ç‚¹èµ | ğŸ’¬ 2 è¯„è®º | â­ 1 æ”¶è—

**ç›®å½•**

å‰è¨€ **ï¼ˆé“¾æ¥æ”¾åœ¨è¯„è®ºåŒºï¼‰ï¼ˆé“¾æ¥æ”¾åœ¨è¯„è®ºåŒºï¼‰ï¼ˆé“¾æ¥æ”¾åœ¨è¯„è®ºåŒºï¼‰**

ç›®çš„ **ï¼ˆé“¾æ¥æ”¾åœ¨è¯„è®ºåŒºï¼‰ï¼ˆé“¾æ¥æ”¾åœ¨è¯„è®ºåŒºï¼‰ï¼ˆé“¾æ¥æ”¾åœ¨è¯„è®ºåŒºï¼‰**

æ€è·¯ **ï¼ˆé“¾æ¥æ”¾åœ¨è¯„è®ºåŒºï¼‰ï¼ˆé“¾æ¥æ”¾åœ¨è¯„è®ºåŒºï¼‰ï¼ˆé“¾æ¥æ”¾åœ¨è¯„è®ºåŒºï¼‰**

ä»£ç å®ç°

1\. ç”¨ openpyxl åº“ä¾¿æ·åˆ›å»º xlsx æ–‡ä»¶ç”¨äºä¿å­˜ä¿¡æ¯

2\. ä¼ªè£…è¯·æ±‚å¤´ï¼Œè®¿é—®ç›®æ ‡ URL

3\. è¯·æ±‚æ–‡æœ¬ä¼ å…¥PyQueryè¿›è¡Œåˆå§‹åŒ–

4\. éå† rank-list çš„ li èŠ‚ç‚¹ï¼Œæ‹¿å–æ¯ä¸€æ¡çš„è¯¦ç»†ä¿¡æ¯

5\. å†™å…¥æ–‡ä»¶

å®Œæ•´ä»£ç 

è¿è¡Œæ•ˆæœ

æ€»ç»“

* * *

### å‰è¨€

ä¸Šä¸€èŠ‚æˆ‘ä»¬å­¦ä¹ äº†PyQueryçš„è¯­æ³•ï¼Œè¿™èŠ‚è¿›è¡Œå®æˆ˜ï¼ŒæŠ“å–æŸç«™**ï¼ˆé“¾æ¥æ”¾åœ¨è¯„è®ºåŒºï¼‰** çš„çƒ­æœæ’è¡Œæ¦œä½œä¸ºç»ƒæ‰‹ã€‚

> æ¶‰åŠçš„åº“ï¼šopenpyxl **requests** ï¼ˆloggingï¼‰ **PyQuery**

* * *

### ç›®çš„

æŠ“å–å°ç”µè§†çƒ­æœæ’è¡Œæ¦œçš„è¯¦ç»†ä¿¡æ¯ï¼ˆåŒ…æ‹¬**å…¨ç«™æ’è¡Œæ¦œTop100çš„æ’åã€è§†é¢‘ä¸»é¢˜ã€é“¾æ¥ã€æ’­æ”¾é‡ã€å¼¹å¹•é‡ä»¥åŠUPä¸»å** ï¼‰å¹¶å¦å­˜åˆ°æ–‡ä»¶**ï¼ˆé“¾æ¥æ”¾åœ¨è¯„è®ºåŒºï¼‰**

* * *

### æ€è·¯

1\. ç”¨ openpyxl åº“ä¾¿æ·åˆ›å»º xlsx æ–‡ä»¶ç”¨äºä¿å­˜ä¿¡æ¯

2\. ä¼ªè£…è¯·æ±‚å¤´ï¼Œè®¿é—®ç›®æ ‡ URL

3\. è¯·æ±‚æ–‡æœ¬ä¼ å…¥PyQueryè¿›è¡Œåˆå§‹åŒ–

4\. éå† rank-list çš„ li èŠ‚ç‚¹ï¼Œæ‹¿å–æ¯ä¸€æ¡çš„è¯¦ç»†ä¿¡æ¯

5\. å†™å…¥æ–‡ä»¶

* * *

### ä»£ç å®ç°

#### 1\. ç”¨ openpyxl åº“ä¾¿æ·åˆ›å»º xlsx æ–‡ä»¶ç”¨äºä¿å­˜ä¿¡æ¯

å¯¼åŒ…

```python from pyquery import PyQuery as pq import requests import logging import openpyxl ``` 

åˆå§‹åŒ–å·¥ä½œè¡¨

```python wb = openpyxl.Workbook() # åˆå§‹åŒ–å·¥ä½œç°¿å¯¹è±¡ sheet = wb.active # è·å–æ´»åŠ¨çš„å·¥ä½œè¡¨ # æ·»åŠ åˆ—å sheet.append(['rank', 'title', 'link', 'bicon_play', 'bicon_barrage', 'creator']) # æ—¥å¿—è¾“å‡ºé…ç½® logging.basicConfig(level=logging.INFO, format='%(asctime)s - %(levelname)s: %(message)s') ``` 

è¿™é‡Œè¿˜æ·»åŠ äº†ä¸€è¡Œæ—¥å¿—è¾“å‡ºçš„é…ç½®ï¼Œå¯ä»¥åœ¨æ§åˆ¶å°æ˜¾ç¤ºå½•å…¥äº†ä»€ä¹ˆä¿¡æ¯ï¼Œä¾¿äºæˆ‘ä»¬å¿«é€Ÿçº é”™ã€‚

#### 2\. ä¼ªè£…è¯·æ±‚å¤´ï¼Œè®¿é—®ç›®æ ‡ URL

```python # ä¼ªè£…è¯·æ±‚å¤´ headers = { "Origin": "è§è¯„è®ºåŒº", "User-Agent": "Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.1 (KHTML, like Gecko) Chrome/22.0.1207.1 Safari/537.1" } # ç›®æ ‡URL url = 'è§è¯„è®ºåŒº' resp = requests.get(url, headers=headers).text ``` 

#### 3\. è¯·æ±‚æ–‡æœ¬ä¼ å…¥PyQueryè¿›è¡Œåˆå§‹åŒ–

```python # requestè¯·æ±‚è·å–çš„æ–‡æœ¬ä¼ å…¥PyQueryåˆå§‹åŒ– doc = pq(resp) ``` 

#### 4\. éå† rank-list çš„ li èŠ‚ç‚¹ï¼Œæ‹¿å–æ¯ä¸€æ¡çš„è¯¦ç»†ä¿¡æ¯

ï¼ˆé€šè¿‡è§‚å¯Ÿé¡µé¢æºä»£ç å‘ç°çš„ï¼Œä¸ç†Ÿæ‚‰çš„å°ä¼™ä¼´ç§»æ­¥ä¸“æ ä»¥å‰å‘å¸ƒè¿‡çš„å®æˆ˜æ–‡ç« ï¼‰

ç»™ä¸€ä¸ªæ¯”è¾ƒè¯¦ç»†çš„æ¡ˆä¾‹å§ï¼š[ä¼ é€é—¨](https://blog.csdn.net/m0_59180666/article/details/128482573 "ä¼ é€é—¨")

```python # è·å–class=rank-list ä¸‹æ‰€æœ‰lièŠ‚ç‚¹å†…å®¹ # éå†lièŠ‚ç‚¹ con1 = doc('.rank-list li') for item in con1.items(): rank = item('.num').text() # æ’å title = item('.content .info a:first-child').text() # è§†é¢‘æ ‡é¢˜ link = 'https:' + item('.content .info a').attr('href') # è§†é¢‘é“¾æ¥ # creator = item('.content .info .detail a span').text() # UPä¸» creator, bicon_play, bicon_barrage = item('.content .info .detail span').text().split(' ') ``` 

#### 5\. å†™å…¥æ–‡ä»¶

```python sheet.append([rank, title, link, bicon_play, bicon_barrage, creator]) logging.info([rank, title, link, bicon_play, bicon_barrage, creator]) wb.save(filename='11_Rank_data.xlsx') ``` 

æ·»åŠ è¡Œï¼Œè¾“å‡ºæ—¥å¿—ã€‚

* * *

### å®Œæ•´ä»£ç 

```python # Created at UESTC # Author: Vector Kun # Time: 2023/1/25 14:32 from pyquery import PyQuery as pq import requests import logging import openpyxl wb = openpyxl.Workbook() # åˆå§‹åŒ–å·¥ä½œç°¿å¯¹è±¡ sheet = wb.active # è·å–æ´»åŠ¨çš„å·¥ä½œè¡¨ # æ·»åŠ åˆ—å sheet.append(['rank', 'title', 'link', 'bicon_play', 'bicon_barrage', 'creator']) # æ—¥å¿—è¾“å‡ºé…ç½® logging.basicConfig(level=logging.INFO, format='%(asctime)s - %(levelname)s: %(message)s') # ä¼ªè£…è¯·æ±‚å¤´ headers = { "Origin": "è§è¯„è®ºåŒº", "User-Agent": "Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.1 (KHTML, like Gecko) Chrome/22.0.1207.1 Safari/537.1" } # ç›®æ ‡URL url = 'è§è¯„è®ºåŒº' # requestè¯·æ±‚è·å–çš„æ–‡æœ¬ä¼ å…¥PyQueryåˆå§‹åŒ– resp = requests.get(url, headers=headers).text doc = pq(resp) # è·å–class=rank-list ä¸‹æ‰€æœ‰lièŠ‚ç‚¹å†…å®¹ # éå†lièŠ‚ç‚¹ con1 = doc('.rank-list li') for item in con1.items(): rank = item('.num').text() # æ’å title = item('.content .info a:first-child').text() # è§†é¢‘æ ‡é¢˜ link = 'https:' + item('.content .info a').attr('href') # è§†é¢‘é“¾æ¥ # creator = item('.content .info .detail a span').text() # UPä¸» creator, bicon_play, bicon_barrage = item('.content .info .detail span').text().split(' ') # print(bicon_play, bicon_view, creator) # æ’å sheet.append([rank, title, link, bicon_play, bicon_barrage, creator]) logging.info([rank, title, link, bicon_play, bicon_barrage, creator]) wb.save(filename='11_Rank_data.xlsx') ``` 

* * *

### è¿è¡Œæ•ˆæœ

![](/images/posts/31.-å®æˆ˜ï¼šPyQueryè·å–å°ç”µè§†Top100è¯¦ç»†ä¿¡æ¯ï¼ˆ/d2dca9723bc6.png)

![](/images/posts/31.-å®æˆ˜ï¼šPyQueryè·å–å°ç”µè§†Top100è¯¦ç»†ä¿¡æ¯ï¼ˆ/de441d20a9a9.png)

å¯ä»¥çœ‹åˆ°æˆåŠŸåœ¨æ§åˆ¶å°è¾“å‡ºäº†æ—¥å¿—ä¿¡æ¯å¹¶ä¸”å°†å…¨ç«™æ’è¡Œæ¦œTop100çš„æ’åã€è§†é¢‘ä¸»é¢˜ã€é“¾æ¥ã€æ’­æ”¾é‡ã€å¼¹å¹•é‡ä»¥åŠUPä¸»åè¾“å…¥åˆ°äº†xlsxæ–‡ä»¶ä¸­ã€‚ 

* * *

### æ€»ç»“

æœ¬èŠ‚æˆ‘ä»¬å¯¹PyQueryè¿›è¡Œäº†å®æˆ˜ï¼Œå®ç°äº†æŠ“å–æŸç«™å…¨ç«™æ’è¡Œæ¦œTop100çš„è¯¦ç»†ä¿¡æ¯ã€‚
