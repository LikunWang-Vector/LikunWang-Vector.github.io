---
title: "32. å®æˆ˜ï¼šPyQueryå®ç°æŠ“å–TXå›¾æ–‡æ–°é—»"
date: 2023-01-27
updated: 2023-01-27
categories:
  - Pythonçˆ¬è™«å…¥é—¨ã€è¿›é˜¶ä¸å®æˆ˜
tags:
  - python
  - å¼€å‘è¯­è¨€
  - pyquery
  - æ•°æ®åˆ†æ
csdn_views: 387
csdn_likes: 1
csdn_comments: 2
csdn_favorites: 1
csdn_url: https://blog.csdn.net/m0_59180666/article/details/128773222
cover: /images/posts/32.-å®æˆ˜ï¼šPyQueryå®ç°æŠ“å–TXå›¾æ–‡æ–°é—»/b52ebe2047c4.png
lang_pair:
  en: "32. Practical: PyQuery Scraping News Articles with Images"
---

> æœ¬æ–‡è¿ç§»è‡ªCSDNåšå®¢
> åŸæ–‡é“¾æ¥ï¼š[32. å®æˆ˜ï¼šPyQueryå®ç°æŠ“å–TXå›¾æ–‡æ–°é—»](https://blog.csdn.net/m0_59180666/article/details/128773222)
> ğŸ“Š 387 é˜…è¯» | ğŸ‘ 1 ç‚¹èµ | ğŸ’¬ 2 è¯„è®º | â­ 1 æ”¶è—

**ç›®å½•**

å‰è¨€ ï¼ˆé“¾æ¥åœ¨è¯„è®ºåŒºï¼‰ï¼ˆé“¾æ¥åœ¨è¯„è®ºåŒºï¼‰ï¼ˆé“¾æ¥åœ¨è¯„è®ºåŒºï¼‰

ç›®çš„ ï¼ˆé“¾æ¥åœ¨è¯„è®ºåŒºï¼‰ï¼ˆé“¾æ¥åœ¨è¯„è®ºåŒºï¼‰ï¼ˆé“¾æ¥åœ¨è¯„è®ºåŒºï¼‰

æ€è·¯ â€‹â€‹â€‹â€‹â€‹â€‹â€‹ï¼ˆé“¾æ¥åœ¨è¯„è®ºåŒºï¼‰ï¼ˆé“¾æ¥åœ¨è¯„è®ºåŒºï¼‰ï¼ˆé“¾æ¥åœ¨è¯„è®ºåŒºï¼‰

ä»£ç å®ç°

1\. æ‹¿åˆ°é¡µé¢æºä»£ç 

2\. è§£æhtmlæ–‡ä»¶

3\. æ‹¿åˆ°æ ‡é¢˜å’Œå†…å®¹

4\. ä¸‹è½½å›¾ç‰‡

5\. ä¿å­˜æ–‡ä»¶

å®Œæ•´ä»£ç 

è¿è¡Œæ•ˆæœ

â€‹ç¼–è¾‘

æ€»ç»“

* * *

### å‰è¨€

æˆ‘ä»¬ä¹‹å‰æåˆ°PyQueryåŒºåˆ«äºå…¶ä»–å‡ ç§è§£ææ–¹å¼çš„æœ€å¤§ä¼˜åŠ¿å°±æ˜¯å¯ä»¥â€œä¿®æ”¹æºä»£ç â€ä»è€Œä¾¿äºæˆ‘ä»¬æå–ä¿¡æ¯ã€‚ä»Šå¤©æˆ‘ä»¬ä»¥TXæ–°é—»ä¸ºä¾‹ï¼Œå¯¹è¿™ä¸ªè§£æçš„ä¼˜åŠ¿ä½œä¸€ä¸ªç®€è¦çš„ä»‹ç»ã€‚

* * *

### ç›®çš„

åˆ©ç”¨Pyquery+MarkdownæŠ“å–TXæ–°é—»çš„æŸä¸€ç¯‡å®Œæ•´å›¾æ–‡å†…å®¹ï¼Œå¹¶ä¿å­˜åˆ°æœ¬åœ°mdæ–‡ä»¶ã€‚

* * *

### æ€è·¯

1\. æ‹¿åˆ°é¡µé¢æºä»£ç 

2\. è§£æhtmlæ–‡ä»¶

3\. æ‹¿åˆ°æ ‡é¢˜å’Œå†…å®¹

4\. ä¸‹è½½å›¾ç‰‡

5\. ä¿å­˜æ–‡ä»¶

* * *

### ä»£ç å®ç°

#### 1\. æ‹¿åˆ°é¡µé¢æºä»£ç 

```python # mainå‡½æ•°ï¼Œå®Œæˆæ‰€æœ‰æ“ä½œ(urlæ™®é€‚) def main(): url = 'è§è¯„è®ºåŒº' resp = requests.get(url) html = resp.text title, essay = get_content(html) save_file(title, essay) ``` 

mainå‡½æ•°ä¸­æ‹¿åˆ°urlçš„æºä»£ç ï¼Œå¹¶ä¼ å…¥get_contentå‡½æ•°ä¸­è·å–æ ‡é¢˜å’Œå†…å®¹ä»¥åŠå›¾ç‰‡ï¼Œæœ€åè°ƒç”¨save_fileå‡½æ•°ä¿å­˜æ–‡ä»¶åˆ°æœ¬åœ°ã€‚ 

#### 2\. è§£æhtmlæ–‡ä»¶

```python # æ‹¿åˆ°æ ‡é¢˜å’Œå†…å®¹ def get_content(html): p = pq(html) ``` 

å¼€å§‹è®²è§£ get_contentå‡½æ•°ï¼Œç¬¬ä¸€æ­¥å°±æ˜¯å…ˆç”¨PyQueryè§£æä¸»å‡½æ•°ä¸­ä¼ å…¥çš„htmlæºä»£ç ã€‚

#### 3\. æ‹¿åˆ°æ ‡é¢˜å’Œå†…å®¹

éšåè§£æå‡ºæ ‡é¢˜å’Œå†…å®¹ã€‚è§‚å¯Ÿæºä»£ç å‘ç°åªæœ‰ä¸€ä¸ªh1æ ‡ç­¾ï¼Œé‚£ä¹ˆç›´æ¥æ‹¿å‡ºæ¥ï¼Œéšåå¯ä»¥å†™åˆ°markdownæ–‡ä»¶ä¸­ã€‚è€Œæ–‡ç« å†…å®¹éƒ¨åˆ†å°±æ¯”è¾ƒå¤æ‚äº†ï¼Œæˆ‘ä»¬è¦å®ç°çš„æ˜¯ä»æœ¬åœ°è¯»å–å›¾ç‰‡ï¼Œé‚£ä¹ˆåŠ¿å¿…è¦å…ˆå°†å›¾ç‰‡ä¸‹è½½åˆ°æœ¬åœ°ï¼Œé‚£ä¹ˆå°±å†å»ºç«‹ä¸€ä¸ªdownload_imgå‡½æ•°ã€‚

```python title = p("h1") # print(title) essay = p("p.one-p") ps = essay("img").items() for p in ps: img_src = p.attr("src") img_uuid = uuid.uuid4() download_img(img_src, img_uuid) p.attr("src", f"1_img_src/{img_uuid}.jpg") # å°†å›¾ç‰‡èµ„æºåœ°å€æ”¹ä¸ºæœ¬åœ° p.attr("alt", "Image Not Found") # print(essay) return title, essay ``` 

æ³¨æ„è¿™è¡Œä»£ç 

```python p.attr("src", f"1_img_src/{img_uuid}.jpg") # å°†å›¾ç‰‡èµ„æºåœ°å€æ”¹ä¸ºæœ¬åœ° p.attr("alt", "Image Not Found") ``` 

**è¿™ä¸¤è¡Œçš„å«ä¹‰å°±æ˜¯åœ¨æ¯ä¸€è¡Œå…·æœ‰imgæ ‡ç­¾çš„pæ ‡ç­¾é‡Œé¢ï¼Œå°†srcå±æ€§æ›¿æ¢ä¸ºæœ¬åœ°è·¯å¾„ï¼Œå¹¶æ·»åŠ ä¸€ä¸ªaltå±æ€§æ¥ä½œä¸ºå›¾ç‰‡æ— æ³•æ˜¾ç¤ºæ—¶çš„æ›¿æ¢æ–‡æœ¬ã€‚**

**è¿™é‡Œå°±ä½“ç°äº†PyQueryçš„ä¼˜è¶Šæ€§**

#### 4\. ä¸‹è½½å›¾ç‰‡

```python # ä¸‹è½½å›¾ç‰‡ï¼Œä¿å­˜åˆ°æœ¬åœ°æŒ‡å®šè·¯å¾„ï¼Œç”¨åŒä¸€ä¸ªuuid def download_img(img_src, img_uuid): download_url = 'https:' + img_src img_resp = requests.get(download_url) file_path = f"1_img_src/{img_uuid}.jpg" with open(file_path, mode='wb') as f: f.write(img_resp.content) ``` 

å¸¸è§„æ“ä½œä¸èµ˜è¿°ï¼Œæ³¨æ„åŒºåˆ†è¿™é‡Œçš„img_src/img_uuidçš„åŒºåˆ« 

#### 5\. ä¿å­˜æ–‡ä»¶

```python # ä¿å­˜Markdownæ–‡ä»¶ def save_file(title, essay): true_title = title.text() with open(f"1_{true_title}.md", mode='w', encoding='utf-8') as f: f.write(str(title)) f.write(str(essay)) ``` 

* * *

### å®Œæ•´ä»£ç 

```python """ PyQuery & Markdown new.xx.comï¼ˆè§è¯„è®ºåŒºï¼‰ """ from pyquery import PyQuery as pq import requests import uuid # mainå‡½æ•°ï¼Œå®Œæˆæ‰€æœ‰æ“ä½œ(urlæ™®é€‚) def main(): url = 'è§è¯„è®ºåŒº' resp = requests.get(url) html = resp.text title, essay = get_content(html) save_file(title, essay) # æ‹¿åˆ°æ ‡é¢˜å’Œå†…å®¹ def get_content(html): p = pq(html) title = p("h1") # print(title) essay = p("p.one-p") ps = essay("img").items() for p in ps: img_src = p.attr("src") img_uuid = uuid.uuid4() download_img(img_src, img_uuid) p.attr("src", f"1_img_src/{img_uuid}.jpg") # å°†å›¾ç‰‡èµ„æºåœ°å€æ”¹ä¸ºæœ¬åœ° p.attr("alt", "Image Not Found") # print(essay) return title, essay # ä¸‹è½½å›¾ç‰‡ï¼Œä¿å­˜åˆ°æœ¬åœ°æŒ‡å®šè·¯å¾„ï¼Œç”¨åŒä¸€ä¸ªuuid def download_img(img_src, img_uuid): download_url = 'https:' + img_src img_resp = requests.get(download_url) file_path = f"1_img_src/{img_uuid}.jpg" with open(file_path, mode='wb') as f: f.write(img_resp.content) # ä¿å­˜Markdownæ–‡ä»¶ def save_file(title, essay): true_title = title.text() with open(f"1_{true_title}.md", mode='w', encoding='utf-8') as f: f.write(str(title)) f.write(str(essay)) if __name__ == '__main__': main() ``` 

* * *

### è¿è¡Œæ•ˆæœ

![](/images/posts/32.-å®æˆ˜ï¼šPyQueryå®ç°æŠ“å–TXå›¾æ–‡æ–°é—»/b52ebe2047c4.png)

### ![](/images/posts/32.-å®æˆ˜ï¼šPyQueryå®ç°æŠ“å–TXå›¾æ–‡æ–°é—»/b255aa3bfec1.png)

ç”±äºPyCharmä¸­ç›¸å¯¹è·¯å¾„çš„å›¾ç‰‡åœ¨mdæ–‡ä»¶ä¸­æ— æ³•æ­£å¸¸æ˜¾ç¤ºï¼Œæ‰€ä»¥æˆ‘ä»¬æ‹¿VSCodeæ¥åšæ¼”ç¤ºï¼Œç›®å‰è¿˜æ²¡æœ‰æ‰¾åˆ°è§£å†³åŠæ³•...æœ‰çŸ¥é“çš„å¤§ä½¬å¯ä»¥åœ¨è¯„è®ºåŒºæˆ–è€…ç§ä¿¡å‘ŠçŸ¥æˆ‘ä¸€ä¸‹ï¼Œè°¢è°¢ï¼ 

* * *

### æ€»ç»“

æœ¬èŠ‚æˆ‘ä»¬å­¦ä¹ è®¤è¯†äº†ç”¨PyQueryä¿®æ”¹htmlæºä»£ç ä»è€Œèƒ½å¤Ÿæ”¹å˜htmlä¼ é€’çš„ä¿¡æ¯ï¼Œå¸®åŠ©æˆ‘ä»¬æ›´æ–¹ä¾¿çš„è·å–å¹¶è§£æä¿¡æ¯ã€‚
